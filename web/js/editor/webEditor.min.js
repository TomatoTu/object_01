!function($,window){function webEditor(a,b){this.element=a,this.$element=$(a),this.$mainBox=this.$element,this.$logoBox=null,this.$logoWindow=null,this.$bannerBox=null,this.$bannerWindow=null,this.$footerBox=null,this.$storeWindow=null,this.$productWindow=null,this.$footerCloseWin=null,this.$upLoadingWindow=null,this.bannerClass=[{id:1,"class":"body-tallHeader"},{id:2,"class":"body-shortHeader"},{id:3,"class":"body-noHeader"},{id:4,"class":"body-titleHeader"}],this.$contentBox=null,this.$comBox=null,this.$moveMask=null,this.$innerMoveMask=null,this.$deleteAlert=null,this.$copyWindow=null,this.$doWindow=null,this.$curCom=null,this.$posMask=null,this.$dropBox=null,this.$dropCom=null,this.$baffle=null,this.$firstChild=null,this.$eidtLeftMask=null,this.$comBar={titleBar:null,txtToolBar:null,txtBar:null,buttonBar:null,dividerBar:null,searchBar:null,imageBar:null,galleryBar:null,galleryLinkBar:null,galleryCaptionBar:null,slideBar:null,slideLinkBar:null,slideCaptionBar:null,codeBar:null,mapBar:null,productBar:null,articleBar:null,flashBar:null,fileBar:null,videoLinkBar:null,socialIconsBar:null,socialIconsItemBar:null},this.dropPos="",this.dropLayer=1,this.isNewBox=!0,this.curComID=0,this.$doc=$(document),this.$topDoc=top.$(document),this.$body=$("body"),this.$topBody=top.$("body"),this.docTime=null,this.topTime=null,this.barTime=null,this.subbarTime=null,this.baffleTime=null,this.options=$.extend({},defaults,b),this.boxParm={left:0,top:0,width:0,height:0},this.comInfo={},this.$colorBox=null,this.$textColorBox=null,this.pageData={logo:null,banner:null,com:null},this.pageDataType={LOGO:"logo",BANNER:"banner",COM:"com"},this.upImgType={UP:1,LINK:2},this.moveType=0,this.moveBoxType=1,this.saveComID=0,this.menuType=1,this.copyType=0,this.iframeLeft=237,this.iframeTop=40,this.uuid=$.getTimeStamp(),this.update=!1,this._init()}var defaults={type:"web",coms:null,moving:!1,deleting:!1,editing:!1,copying:!1,disable:!1,pageid:0,mouseTop:0,mouseLeft:0,moveMaskWidth:0,moveMaskHeight:0,editorTop:0,editorLeft:0,status:0,gap:5,layer:3,jsurl:"/js/editor"};webEditor.prototype={_init:function(){this.$body.append('<script src="'+this.options.jsurl+'/bar/extend.js"><'+"/script>"),this._initMoveMask(),this._initComWindow(this),this.$eidtLeftMask=top.$("#editTool").find(".edit-left-mask-b:first"),"web"==this.options.type?(this._initLeftComs(this),this._initUpLoading(0),this._autoCountWidth()):"wap"==this.options.type&&(this.options.disable=!0),this.GetPage(0),this._eDocKeyDown()},initMain:function(){var b,c,a=this;this.$contentBox=$(this.$element.find("div.wrap-content-in:first")),this.$comBox=this.$contentBox,2==this.menuType&&this.$eidtLeftMask.show(),1==this.menuType&&this._initCopyWindow(),1==this.menuType,b=this.$element.find("div.w-logo:first"),b.length>0&&(this.$logoBox=b,this.$logoWindow=null,this._initLogoWindow(this),this._initLogoEvent(this)),c=this.$element.find("div.banner:first"),c.length>0&&(this.$bannerBox=c,this.$bannerWindow=null,this._initBannerWindow(this),this._initBannerEvent(this)),this.$baffle=null,this.$contentBox.find("div.li-div[data-id]").each(function(){$(this).hasClass("col-li-div")?a._initTableBox(a,$(this)):a._initBindComEvent(a,$(this))}),this.moveBoxType=1,this._initComWindow(),this._initFooter()},clearMain:function(){this.$contentBox=null,this.$comBox=null,this.$bannerBox=null,this.$footerBox=null,null!=this.$baffle&&(this.$baffle.hide(),null!=this.baffleTime&&clearInterval(this.baffleTime)),null!=this.$footerCloseWin&&this.$footerCloseWin.hide(),this.moveBoxType=1},_initCopyWindow:function(){var c,d,e,a=this,b=this.$copyWindow.find("div.list-box-b:first");b.html(""),c='<ul><li style="display:none;" data-pageid="'+HOSTCONFIG.PAGE_ID+'"  data-disable="0"><i>(当前页面)</i></span></li>'+this._createCopyMenuHtml(0,1)+"</ul>",b.html(c),d=this.$copyWindow.find(".pop-btn-group-b .btn-b"),e=this.$copyWindow.find("div.list-box-b:first"),this.$copyWindow.off("click").on("click",function(){return!1}),$(d[0]).removeClass("btn-gray-b").addClass("btn-green-b").addClass("btn-cur"),$(d[1]).removeClass("btn-green-b").removeClass("btn-cur").addClass("btn-gray-b"),$(d[0]).off("click").on("click",function(){return a.copyType=0,$(this).removeClass("btn-gray-b").addClass("btn-green-b").addClass("btn-cur"),$(d[1]).removeClass("btn-green-b").removeClass("btn-cur").addClass("btn-gray-b"),e.find("li:first").hide(),!1}),$(d[1]).off("click").on("click",function(){return a.copyType=1,$(this).removeClass("btn-gray-b").addClass("btn-green-b").addClass("btn-cur"),$(d[0]).removeClass("btn-green-b").removeClass("btn-cur").addClass("btn-gray-b"),e.find("li:first").show(),!1}),b.find("li").each(function(){$(this).click(function(){var b=$(this);return 0==b.attr("data-disable")&&a.CopyCom(a.$copyWindow.attr("data-id"),b.attr("data-pageid")),!1})})},_createCopyMenuHtml:function(a,b){var e,f,g,c=this,d="";for(e=0;e<SITEMENUS.length;e++)if(SITEMENUS[e].parent_id==a){if(f="",g=0,1!=SITEMENUS[e].type)f="page-cur",g=1;else if(SITEMENUS[e].id==HOSTCONFIG.PAGE_ID)continue;d+='<li class="'+f+'" data-pageid="'+SITEMENUS[e].id+'" data-disable="'+g+'">'+(b>1?'<span class="sub2-devider">'+c._getNbsp(b)+"</span>":"")+"<span>"+SITEMENUS[e].name+"</span></li>",d+=c._createCopyMenuHtml(SITEMENUS[e].id,b+1)}return d},_getNbsp:function(a){var c,b="";for(c=1;a>c;c++)b+="&nbsp;&nbsp;";return b},_initMoveMask:function(){null==this.$moveMask&&(this.$moveMask=$('<div class="li-div-move" style="z-index:10000"></div>'),this.$moveMask.hide(),this.$topBody.append(this.$moveMask),this.$innerMoveMask=$('<div class="li-div-move" style="z-index:10000"></div>'),this.$innerMoveMask.hide(),this.$body.append(this.$innerMoveMask),this.options.moveMaskWidth=this.$moveMask.outerWidth(),this.options.moveMaskHeight=this.$moveMask.outerHeight()),null==this.$posMask&&(this.$posMask=$('<div class="posmask" style="z-index:1000"></div>'),this.$body.append(this.$posMask))},_initUpLoading:function(a){if(null==this.$upLoadingWindow){var b='<div style=" position:fixed;bottom:5px;right:20px;" class="pop-down-b pop-down-gray-b"><div class="pop-in-b"><div class="pop-inner-b"><div class="process-b"><div class="pop-div-label">上传进度</div><div class="progress"><div id="upLoadingWidth" style="width:0%" aria-valuemax="100" aria-valuemin="0" aria-valuenow="40" role="progressbar" class="progress-bar progress-bar-success progress-bar-striped"><span class="sr-only">0% Complete (success)</span></div></div><div class="clearfix"><div class="fl">上传中...</div></div></div></div></div></div>';this.$upLoadingWindow=$(b),this.$upLoadingWindow.hide(),this.$topBody.append(this.$upLoadingWindow)}a>0?(this.$upLoadingWindow.show(),top.$("#upLoadingWidth").css("width",a+"%")):(top.$("#upLoadingWidth").css("width","0%"),this.$upLoadingWindow.hide())},_initLogoWindow:function(a){var b,c,d,e,f;null==this.$logoWindow&&(b='<div class="pop-down-b pop-down-gray-b logo-pop-b" style="width:238px;"><div class="pop-down-arrow-b" style="left:50px;"></div><div class="pop-in-b"><div class="pop-inner-b"><div class="logo-edit-b"><div class="pop-btn-group-b"><span class="btn-b btn-gray-b">关闭</span><span class="btn-group-divider"></span><span class="btn-b btn-gray-b btn-cur">文字</span><span class="btn-group-divider"></span><span class="btn-b btn-gray-b">图片</span><span class="logoEdit" style="display:none;"><span class="btn-group-divider"></span><span class="btn-orange-b btn-b">编辑</span><span class="btn-group-divider"></span><span class="btn-b btn-gray-b"><i aria-hidden="true" class="glyphicon glyphicon-trash"></i></span></span></div></div></div></div></div>',this.$logoWindow=$(b),this.$logoWindow.hide(),this.$logoBox.append(this.$logoWindow),c=this.$logoWindow.find("span.btn-b"),d=this.$logoWindow.find("span.logoEdit"),e=function(b){a._initUpImgWin(b,function(b,c,d,e){a.$logoBox.find(".w-logo-img img").attr("src",d),a._cacheLogoData("logo_resource_id",c),e==a.upImgType.UP?a._cacheLogoData("logo_img_url",""):e==a.upImgType.LINK&&a._cacheLogoData("logo_img_url",d),f(),a._setLogoWinPos(),a.$logoBox.find(".w-logo-img img").off("load").on("load",function(){a._setLogoWinPos()})})},f=function(){a._cacheLogoData("logo_type",2),c.removeClass("btn-cur"),$(c[2]).addClass("btn-cur"),a.$logoWindow.css("width",366),a.$logoBox.find("h1").hide(),a.$logoBox.find(".w-logo-img").show(),d.show()},$(c[0]).click(function(){$(this).hasClass("btn-cur")||(a.$logoWindow.css("width",238),a._cacheLogoData("logo_type",0),a.CloseLogo(),c.removeClass("btn-cur"),a.$logoBox.find("h1").hide(),a.$logoBox.find(".w-logo-img").hide(),$(this).addClass("btn-cur"),d.hide())}),$(c[1]).click(function(){$(this).hasClass("btn-cur")||(a.$logoWindow.css("width",238),c.removeClass("btn-cur"),a.$logoBox.find("h1").show(),a.$logoBox.find(".w-logo-img").hide(),$(this).addClass("btn-cur"),a._cacheLogoData("logo_type",1),d.hide(),a._setLogoWinPos())}),$(c[2]).click(function(){if(!$(this).hasClass("btn-cur")){var b=a.$logoBox.find(".w-logo-img img").attr("src");$.isEmpty(b)?e(a.$logoBox):(a.$logoWindow.css("width",366),f()),a._setLogoWinPos()}}),$(c[3]).click(function(){e(a.$logoBox)}),$(c[4]).click(function(){a.$logoBox.find(".w-logo-img img").attr("src",""),$(c[1]).click(),a._cacheLogoData("logo_type",1),a._cacheLogoData("logo_resource_id",null),a._cacheLogoData("logo_img_url",""),a._setLogoWinPos()}),this.$logoWindow.on("click",function(){return!1}))},_setLogoWinPos:function(){var a=this.$logoWindow.css("text-align"),b=0;switch(a){case"center":b=(this.$logoBox.width()-this.$logoWindow.width())/2;break;case"right":b=this.$logoBox.width()-this.$logoWindow.width()}0>b&&(b=0),this.$logoWindow.css({top:this.$logoBox.height(),left:b}),this.$logoWindow.show()},_initLogoEvent:function(a){var b,c,d;null!=this.$logoBox&&(this.$logoBox.hover(function(){return a.options.moving||a.options.disable?!1:(a._setLogoWinPos(),void 0)},function(){return a.options.moving||a.options.disable?!1:(a.$logoWindow.hide(),void 0)}),this.$logoBox.on("click",function(b){return a.CloseBanner(),a.CloseBar(),b.stopPropagation(),!1}),$(this.$logoBox.find("h1:first")).on("keyup",function(){a._cacheLogoData("logo_txt",$(this).text())}),a.$logoWindow.css("width",238),b=this.$logoWindow.find("span.logoEdit"),c=this.$logoWindow.find("span.btn-b"),null!=SITECONFIG&&(c.removeClass("btn-cur"),$(c[SITECONFIG["logo_type"]]).addClass("btn-cur"),2==SITECONFIG["logo_type"]&&(a.$logoWindow.css("width",366),b.show(),d=b.find("span.btn-b"),$(d[0]).show(),SITECONFIG["resource_id"]>0&&$(d[1]).show())))},_initBannerWindow:function(a){var b,c,d;null==this.$bannerWindow&&(b='<div class="banner_control"><div class="banner_edit">编辑banner</div><div class="show_control" data-show="1">隐藏</div></div>',this.$bannerWindow=$(b),this.$bannerWindow.hide(),this.$bannerWindow.insertBefore(this.$bannerBox),this.$bannerWindow.on("click",function(a){return a.stopPropagation(),!1}),c=this.$bannerWindow.find("div.banner_edit:first"),d=this.$bannerWindow.find("div.show_control:first"),c.click(function(){}),d.click(function(){var b=$(this).attr("data-show");b=1==b?0:1,0==b?(a.$bannerBox.hide(),c.hide(),d.html("显示Banner")):(a.$bannerBox.show(),c.show(),d.html("隐藏")),a._cacheBannerData("is_show",b),$(this).attr("data-show",b)}))},_setBannerWinPos:function(){null!=this.$bannerBox&&(this.options.disable?this.$bannerWindow.hide():this.$bannerWindow.show())},_initBannerEvent:function($self){var editBanner,showBanner,temBanner,bannerSlider,createBannerHtml,pause=5,speed=500,scale="";null!=this.$bannerBox&&(editBanner=this.$bannerWindow.find("div.banner_edit:first"),showBanner=this.$bannerWindow.find("div.show_control:first"),this.$bannerWindow.show(),this.$bannerBox.on("click",function(a){return $self.options.moving||$self.options.disable?!1:($self.CloseLogo(),$self.CloseBar(),a.stopPropagation(),!1)}),temBanner=PAGEJSON.banner,temBanner&&(0==temBanner["is_show"]?(editBanner.hide(),showBanner.html("显示Banner")):(editBanner.show(),showBanner.html("隐藏")),showBanner.attr("data-show",temBanner["is_show"])),bannerSlider=null,createBannerHtml=function(){var d,a=PAGEJSON.banner,b="",c=!1;if(null!=bannerSlider&&bannerSlider.destroySlider(),1==a.type)if(a.items&&a.items.length>0)if(1==a.items.length)b+='<img src="'+HOSTCONFIG.WEB_URL+a.items[0]["path"]+'" />';else{for(c=!0,b+='<ul class="bxslider">',d=0;d<a.items.length;d++)b+='<li><img src="'+HOSTCONFIG.WEB_URL+a.items[d]["path"]+'" ></li>';b+="</ul>"}else b+='<img src="/template/'+HOSTCONFIG.THEME+'/images/banner.jpg" />';else 2==a.type&&a.items&&a.items.length>0&&(b+='<object type="application/x-shockwave-flash" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" align="middle" width="100%">',b+='<param name="movie" value="'+HOSTCONFIG.WEB_URL+a.items[0]["path"]+'">',b+='<param name="quality" value="high"><param name="play" value="true"> <param name="loop" value="true"><param name="wmode" value="transparent"><param name="allowFullScreen" value="true"><param name="flashvars" value="">',b+='<embed src="'+HOSTCONFIG.WEB_URL+a.items[0]["path"]+'" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" play="true" loop="true" wmode="transparent" allowfullscreen="true" flashvars="" type="application/x-shockwave-flash" align="middle" width="100%"></object>');$self.$bannerBox.html(b),c&&(bannerSlider=$self.$bannerBox.find(".bxslider:first").bxSlider({mode:"fade",auto:!0,autoControls:!1,infiniteLoop:!0,hideControlOnEnd:!0,adaptiveHeight:!0,minSlides:1,maxSlides:2,scale:scale,speed:speed,pause:1e3*pause}))},editBanner.click(function(){var url=$self.options.jsurl+"/bar/banner.html",win=$("<div></div>");top.$.Loading(),win.load(url+"?t="+$.getTimeStamp(),null,function(response,status,xhr){top.$.UnLoading(),top.$.WinDialog(win,function(winDialog,winBox){var curBanner,i,bannerConfig,inputList,addImg=win.find("li.add-more:first"),tabMenu=win.find("div.images-pop-menu:first li"),tabList=win.find("div.conSlide"),btnSave=win.find(".pop-edit-btns-b:first"),btnSet=$(tabList[0]).find("div.con-top:first"),setWin=win.find("div.bannerSet_slide:first"),flashShow=$(tabList[1]).find("div.slide-imgs"),bannerScale=win.find("div.bannerscale li"),bannerType=1,setImg=function(a,b){var d,e,c=$('<li><div class="gallery-img"><img src="'+HOSTCONFIG.WEB_URL+b+'"></div><div class="gallery-tool-b" style="display:none;"><div class="gallery-tool-in-b"><span title="删除图片" aria-hidden="true" class="glyphicon glyphicon-trash"></span></div></div></li>');c.attr({"data-responseid":a,"data-path":b}),c.insertBefore(addImg),d=c.find("div.gallery-tool-b:first"),e=c.find("div.gallery-tool-in-b:first"),c.hover(function(){d.show()},function(){d.hide()}),e.click(function(){var d,e,a=$(this).parents("li:first"),b=a.attr("data-responseid"),c=PAGEJSON.banner;for(d=0;d<c.length;d++)for(e=0;e<c.items.length;e++)if(c.items[e].responseid==b){c.items[e]["delete"]=1;break}a.remove()}),setAddImgShow(),btnSet.show()},setFlash=function(a,b){var c='<object type="application/x-shockwave-flash" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" align="middle" width="300">';c+='<param name="movie" value="'+HOSTCONFIG.WEB_URL+b+'">',c+='<param name="quality" value="high"><param name="play" value="true"> <param name="loop" value="true"><param name="wmode" value="transparent"><param name="allowFullScreen" value="true"><param name="flashvars" value="">',c+='<embed src="'+HOSTCONFIG.WEB_URL+b+'" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" play="true" loop="true" wmode="transparent" allowfullscreen="true" flashvars="" type="application/x-shockwave-flash" align="middle" width="300"></object>',flashShow.html(c),flashShow.attr({"data-responseid":a,"data-path":b}).show()},setAddImgShow=function(){win.find("#slide_images_list").find("li").length>=11?addImg.hide():addImg.show()};if(top.$.onUpload({pick:{id:"#bannerUpImg",label:'<img src="/images/pop_add.png">',multiple:!1},disableGlobalDnd:!1},{uploadStart:function(){},uploadFinished:function(){$self._initUpLoading(0)},uploadProgress:function(a,b){$self._initUpLoading(100*b)},uploadSuccess:function(a,b){"SUCCESS"==b.state?setImg(b.id,b.url):top.$.ShowResultMag("上传失败。",!1)}}),top.$.onUpload({server:"/upload/uploadflash",pick:{id:"#bannerUpFlash",label:"选择Flash文件",multiple:!1},accept:{title:"File",extensions:"swf",mimeTypes:"*.swf"},disableGlobalDnd:!1},{uploadStart:function(){},uploadFinished:function(){$self._initUpLoading(0)},uploadProgress:function(a,b){$self._initUpLoading(100*b)},uploadSuccess:function(a,b){"SUCCESS"==b.state?setFlash(b.id,b.url):top.$.ShowResultMag("上传失败。",!1)}}),tabMenu.each(function(){$(this).click(function(){tabMenu.removeClass("cur"),$(this).addClass("cur");var a=tabMenu.index($(this));0==a?($(tabList[0]).css({left:"0"}),$(tabList[1]).css({left:"-100%"}),win.find("bannerUpImg").removeClass("webuploader-element-invisible").addClass("webuploader-container"),win.find("#bannerUpFlash").removeClass("webuploader-container").addClass("webuploader-element-invisible")):1==a&&($(tabList[0]).css({left:"-100%"}),$(tabList[1]).css({left:"0"}),setWin.animate({left:"-100%"},500),win.find("bannerUpImg").removeClass("webuploader-container").addClass("webuploader-element-invisible"),win.find("#bannerUpFlash").removeClass("webuploader-element-invisible").addClass("webuploader-container")),bannerType=a+1})}),btnSet.click(function(){setWin.animate({left:0},500)}),setWin.find("div.back").click(function(){setWin.animate({left:"-100%"},500)}),btnSave.click(function(){var c,d,e,a=[],b=win.find("#slide_images_list").find("li");$self._cacheBannerData("type",1),$self._cacheBannerData("config",""),c=1,(1==bannerType&&b.length>1||2==bannerType&&!flashShow.attr("data-responseid"))&&(c=1,b.each(function(){$(this).hasClass("add-more")||(a[a.length]={resource_id:$(this).attr("data-responseid"),path:$(this).attr("data-path"),order_num:c++})})),(1==bannerType&&b.length<=1&&flashShow.attr("data-responseid")||2==bannerType&&flashShow.attr("data-responseid"))&&(a[0]={resource_id:flashShow.attr("data-responseid"),path:flashShow.attr("data-path"),order_num:c++},$self._cacheBannerData("type",2)),$self._cacheBannerData("items",a),1==PAGEJSON.banner["type"]&&a.length>1&&(scale=win.find("div.bannerscale li.selected:first").attr("data-value"),d=win.find("input.inputgray60"),pause=$(d[0]).val(),speed=$(d[1]).val(),pause>0?pause:pause=5,speed>0?speed:speed=500,e='{"scale":"'+scale+'","pause":"'+pause+'","speed":"'+speed+'"}',$self._cacheBannerData("config",e)),createBannerHtml(),winBox.remove(),winDialog.remove()}),bannerScale.each(function(){$(this).click(function(){bannerScale.removeClass("selected"),$(this).addClass("selected")})}),curBanner=PAGEJSON.banner){if(bannerType=curBanner.type,$(tabMenu[bannerType-1]).addClass("cur"),1==bannerType){if($(tabList[0]).css({left:"0"}),$(tabList[1]).css({left:"-100%"}),null!=curBanner.items)for(i=0;i<curBanner.items.length;i++)curBanner.items[i]["delete"]||setImg(curBanner.items[i].resource_id,curBanner.items[i].path)}else 2==bannerType&&($(tabList[0]).css({left:"-100%"}),$(tabList[1]).css({left:"0"}),null!=curBanner.items&&curBanner.items.length>0&&setFlash(curBanner.items[0].resource_id,curBanner.items[0].path));if(bannerConfig=curBanner.config,!$.isNllEmpty(bannerConfig)){if(bannerConfig=eval("("+bannerConfig+")"),bannerConfig.scale)for(scale=bannerConfig.scale,i=0;i<bannerScale.length;i++)if($(bannerScale[i]).attr("data-value")==scale){bannerScale.removeClass("selected"),$(bannerScale[i]).addClass("selected");break}inputList=win.find("input.inputgray60"),$.isNllEmpty(bannerConfig.pause)||(pause=bannerConfig.pause,pause>0?pause:pause=5,$(inputList[0]).val(pause)),$.isNllEmpty(bannerConfig.speed)||(speed=bannerConfig.speed,speed>0?speed:speed=500,$(inputList[1]).val(speed))}}})})}))},_initProductWindow:function(a){var c,d,b=this.$contentBox.find("div.product-detail-wrap:first");null==this.$productWindow&&(c='<div class="pop-up-b" style="top:0px;right:0px"><div class="pop-up-arrow-b" style="left:88px;"></div><div class="pop-in-b"><div class="pop-inner-b"><div class="pop-content-b"><div class="prd-btns-edit-b"><span class="btn btn-green-b">Edit Product</span></div></div></div></div></div>',this.$productWindow=$(c),this.$productWindow.hide(),d=this.$productWindow.find("span.btn-green-b"),$(d[0]).click(function(){top.$.goToPage("store","products","detail","products_form",SITECURMENU.prduct_id)}),b.append(this.$productWindow)),b.hover(function(){a.$productWindow.show()},function(){a.$productWindow.hide()})},_initStoreWindow:function(a){var c,d,b=this.$contentBox.find("div.w-store:first");null==this.$storeWindow&&(c='<div class="pop-up-b" style="top:-22px;right:0px"><div class="pop-up-arrow-b" style="left:165px;"></div><div class="pop-in-b"><div class="pop-inner-b"><div class="pop-content-b"><div class="prd-btns-edit-b"><span class="btn btn-green-b mr10">Edit Storefront</span> <span class="btn btn-green-b">Add Product</span> </div></div></div></div></div>',this.$storeWindow=$(c),this.$storeWindow.hide(),d=this.$storeWindow.find("span.btn-green-b"),$(d[0]).click(function(){top.$.goToPage("store","storefront","show","storefront")}),$(d[1]).click(function(){top.$.goToPage("store","products","show","products")}),b.append(this.$storeWindow)),b.hover(function(){a.$storeWindow.show()},function(){a.$storeWindow.hide()})},_initFooter:function(){var b,c,a=this;this.$footerBox=$("#comFootMainInner"),null==this.$footerCloseWin&&(b='<div class="pop-edit-btns-b" style="position:absolute;top:0;left:0;"><span class="btn btn-orange-b">关闭</span></div>',this.$footerCloseWin=$(b),this.$footerCloseWin.hide(),this.$body.append(this.$footerCloseWin)),this.$footerCloseWin.click(function(){return 1!=a.menuType&&a.$eidtLeftMask.show(),null!=a.baffleTime&&window.clearInterval(a.baffleTime),a.moveBoxType=1,a.$comBox=a.$mainBox,a.$baffle.css({left:0,top:0}).hide(),$(this).css({left:0,top:0}).hide(),0==a.$footerBox.children().length&&null!=a.$firstChild&&(a.$footerBox.append(a.$firstChild),a.$firstChild.show(),a.$firstChild=null),a.CloseBar(),a.$footerBox.find("div.li-div[data-id]").each(function(){$(this).hasClass("col-li-div")?$(this).off("mouseenter mouseleave"):$(this).off("click mouseenter mouseleave")}),!1}),c=function(){var b=a.$footerBox.offset(),c=a.$footerBox.outerWidth();a.$footerCloseWin.css({top:b.top-a.$footerCloseWin.outerHeight()-5,left:c+b.left-a.$footerCloseWin.outerWidth()+20}).show()},this.$footerBox.click(function(){if(a.options.disable)return!1;a._clearFun(),a.$eidtLeftMask.hide();var b=$(this).find("div:first-child");return a.$firstChild=null,b.length>0&&b.hasClass("foot-add-notice-b")&&(a.$firstChild=b,a.$firstChild.hide(),a.$body.append(a.$firstChild)),a._initBaffle($(this)),a.baffleTime=window.setInterval(function(){a._initBaffle(a.$footerBox)},200),c(),a.$baffle.show(),a.moveBoxType=2,a.$comBox=a.$footerBox,$(this).find("div.li-div[data-id]").each(function(){$(this).hasClass("col-li-div")?a._initTableBox(a,$(this)):a._initBindComEvent(a,$(this))}),!1}),this.$footerBox.find("div.li-div[data-id]").each(function(){$(this).hasClass("col-li-div")||(a._initBindComEvent(a,$(this)),$(this).off("click mouseenter mouseleave"))})},_initComWindow:function(){if(null==this.$doWindow){var b='<div class="editbox-pop-b" data-edit="0"><div class="moveto-b"><div class="btn-moveto-b"><span aria-hidden="true" class="glyphicon glyphicon-share-alt"></span></div></div><div class="move-b"><div class="btn-move-b"><span aria-hidden="true" class="glyphicon glyphicon-move"></span></div></div><div class="delete-b"><div class="btn-delete-b"><span aria-hidden="true" class="glyphicon glyphicon-remove"></span></div></div></div>';this.$doWindow=$(b),this.$doWindow.hide(),this.$body.append(this.$doWindow)}null==this.$copyWindow&&(this.$copyWindow=$('<div style="left:-20px; top:10px;" class="pop-down-b"><div style="left:10px;" class="pop-down-arrow-b"></div><div class="pop-in-b"><div class="pop-inner-b"><div class="pop-header-b"><div class="pop-btn-group-b"><a class="btn-b btn-green-b btn-cur" href="javascript:void(0);">移动</a><span class="btn-group-divider"></span><a class="btn-b btn-gray-b" href="javascript:void(0);">复制</a></div></div><div class="pop-content-b"><div class="list-box-b"></div></div></div></div></div>'),this.$copyWindow.hide(),this.$body.append(this.$copyWindow)),null==this.$deleteAlert&&(this.$deleteAlert=$('<div class="pop-up-b"><div style="right:10px;" class="pop-up-arrow-b"></div><div class="pop-in-b"><div class="pop-inner-b"><div class="pop-content-b"><div class="pop-delete-b"><p>确认是否删除?</p><input type="button" value="删除" class="btn-b btn-red-b" /></div></div></div></div></div>'),this.$deleteAlert.hide(),this.$body.append(this.$deleteAlert)),this._bindDoWindowEvent()},_bindDoWindowEvent:function(){var c,d,a=this,b=this.$doWindow.find("div.delete-b:first");1==b.length&&b.off("click").click(function(){a.CloseAll();var b=a.$doWindow.parent();return b.addClass("li-div-delete-hover"),a.$deleteAlert.insertAfter(a.$doWindow).css({top:0-a.$deleteAlert.height()-6,right:-20}).fadeIn(),a.$deleteAlert.attr("data-id",b.attr("data-id")),!1}),c=this.$doWindow.find("div.moveto-b:first"),1==c.length&&c.off("click").click(function(){a.CloseAll(),a.options.copying=!0;var b=a.$doWindow.parent();return a.$doWindow.parent().addClass("li-div-moveto-hover"),a.$copyWindow.insertAfter(a.$doWindow).fadeIn(),a.$copyWindow.attr("data-id",b.attr("data-id")),!1}),d=this.$doWindow.find("div.move-b:first"),1==d.length&&d.off("mousedown click").mousedown(function(b){a.CloseAll();var c=a.$doWindow.parent();return a._eComMainMouseDown(b,a,c),!1}).click(function(a){a.stopPropagation()}),this.$deleteAlert.find("input:first").off("click").click(function(){a.$element.find(".li-div-delete-hover").removeClass("li-div-hover").removeClass("li-div-delete-hover"),a.$deleteAlert.hide(),a.options.deleting=!0;var b=$("#com_"+a.$deleteAlert.attr("data-id"));return a._deleteCurCom(b),!1})},_deleteCurCom:function(a){var b=this,c=a.parents("td.td-w[data-id]:first"),d=a.parents("div.col-li-div[data-id]:first"),e=0,f=0,g=0;d.length>0&&1==c.find("div.li-div[data-id]").length&&(e=d.attr("data-id"),f=d.find("td.td-w[data-id="+e+"]").length,g=a.attr("data-column")),b.DeleteCom(a.attr("data-id"),e,f,g,function(){b.$body.append(b.$doWindow),b.$body.append(b.$deleteAlert),b.$body.append(b.$copyWindow),a.remove(),b._deleteInitBox(e)})},_deleteInitBox:function(a){var f,b=$("#com_"+a),c=b.find("td.td-w[data-id="+a+"]"),d=c.length,e=0;c.each(function(){0==$(this).find("div.li-div[data-id]").length&&($(this).remove(),e+=parseFloat($(this).attr("width").replace("%","")),d--)}),1>=d?(f=b.find("div.div-padding:first").children("div.li-div[data-id]"),f.each(function(){$(this).insertBefore(b)}),this._delCacheComData(a),b.remove()):(c=b.find("td.td-w[data-id="+a+"]"),c.each(function(){var a=parseFloat($(this).attr("width").replace("%",""));$(this).attr("width",a+e/c.length+"%")}),this._initTableBox(this,b)),null!=this.$comBox&&0==this.$comBox.children().length&&1==this.moveBoxType&&this.$comBox.html('<div class="main-empty-notice-b">请拖拉组件放置此处</div>'),2==this.moveBoxType&&this._initBaffle(this.$footerBox)},_initBaffle:function(a){var b,c,d,e,f,g,h,i,j,k;return null==this.$baffle&&(b='<div class="split-mask" style="z-index:10;top:0;left:0;position:absolute;height:0px;"><div class="mask-split-b" style="display:block"></div><div class="mask-split-b" style="display:block"></div><div class="mask-split-b" style="display:block"></div><div class="mask-split-b" style="display:block"></div><div class="mask-line mask-line-top" style="display:block"></div><div class="mask-line mask-line-left" style="display:block"></div><div class="mask-line mask-line-right" style="display:block"></div><div class="mask-line mask-line-bottom" style="display:block"></div><div class="mask-line-radius mask-radius-top-left" style="display:block"></div><div class="mask-line-radius mask-radius-top-right" style="display:block"></div><div class="mask-line-radius mask-radius-bottom-left" style="display:block"></div><div class="mask-line-radius mask-radius-bottom-right" style="display:block"></div></div>',this.$baffle=$(b),this.$baffle.hide(),this.$body.append(this.$baffle)),c=this.$baffle.find(".mask-split-b"),null==a?!1:(d=a.offset(),e=a.outerWidth(),f=a.outerHeight(),g=this.$element.outerWidth(),h=this.$element.outerHeight(),this.$baffle.css("width",g),i=20,$(c[0]).css({top:0,left:0,height:d.top,width:g}),$(c[1]).css({top:d.top,left:0,height:f,width:d.left-i}),$(c[2]).css({top:d.top,left:d.left+e+i,height:f,width:g-d.left-e-i}),$(c[3]).css({top:d.top+f,left:0,height:h-(d.top+f),width:g}),j=this.$baffle.find(".mask-line"),$(j[0]).css({top:d.top,left:d.left-i,height:1,width:e+2*i}),$(j[1]).css({top:d.top,left:d.left-i,height:f,width:1}),$(j[2]).css({top:d.top,left:d.left+e+i,height:f,width:1}),$(j[3]).css({top:d.top+f,left:d.left-i,height:1,width:e+2*i}),k=this.$baffle.find(".mask-line-radius"),$(k[0]).css({top:d.top,left:d.left-i}),$(k[1]).css({top:d.top,left:d.left+e-4+i}),$(k[2]).css({top:d.top+f-4,left:d.left-i}),$(k[3]).css({top:d.top+f-4,left:d.left+e-4+i}),void 0)},_initLeftComs:function(a){var d,e,f,g,h,b={list:[{sortname:"基础",itemlist:[{comname:"标题",comclass:"icon-title",nameclass:"",comtype:COMPONENTTYPE.TITLE},{comname:"文本",comclass:"icon-text",nameclass:"",comtype:COMPONENTTYPE.TEXT},{comname:"富文本",comclass:"icon-richText",nameclass:"",comtype:COMPONENTTYPE.RICHTXT},{comname:"按钮",comclass:"icon-button",nameclass:"",comtype:COMPONENTTYPE.BUTTON},{comname:"分隔线",comclass:"icon-divider",nameclass:"",comtype:COMPONENTTYPE.DIVIDER},{comname:"间隔",comclass:"icon-spacer",nameclass:"",comtype:COMPONENTTYPE.SPACER},{comname:"搜索",comclass:"icon-searchbox",nameclass:"",comtype:COMPONENTTYPE.SEARCH},{comname:"图片",comclass:"icon-image",nameclass:"",comtype:COMPONENTTYPE.IMAGE},{comname:"图片集",comclass:"icon-gallery",nameclass:"",comtype:COMPONENTTYPE.GALLERY},{comname:"幻灯片",comclass:"icon-slideshow",nameclass:"lh1",comtype:COMPONENTTYPE.SLIDESHOW},{comname:"代码",comclass:"icon-embedcode",nameclass:"lh1",comtype:COMPONENTTYPE.CODE},{comname:"地图",comclass:"icon-map",nameclass:"",comtype:COMPONENTTYPE.MAP}]},{sortname:"多媒体",itemlist:[{comname:"Flash",comclass:"icon-flash",nameclass:"",comtype:COMPONENTTYPE.FLASH},{comname:"文件",comclass:"icon-file",nameclass:"",comtype:COMPONENTTYPE.FILE},{comname:"视频链接",comclass:"icon-videoNew",nameclass:"lh1",comtype:COMPONENTTYPE.VIDEOLINK}]},{sortname:"系统",itemlist:[{comname:"产品组件",comclass:"icon-product",nameclass:"",comtype:COMPONENTTYPE.PRODUCT},{comname:"文章组件",comclass:"icon-news",nameclass:"",comtype:COMPONENTTYPE.ARTICLE}]},{sortname:"增值",itemlist:[{comname:"社交图标",comclass:"icon-socialVedio",nameclass:"lh1",comtype:COMPONENTTYPE.SOCIALICONS}]}]},c="";for(d=0;d<b.list.length;d++){for(c+='<div class="section'+(d+1)+'">'+'<h4 id="section'+(d+1)+'">'+b.list[d].sortname+"</h4>"+"<ul>",e=0;e<b.list[d].itemlist.length;e++)f=b.list[d].itemlist[e],c+='<li data-type="'+f.comtype+'"><div class="li-div"><i class="icon-tool '+f.comclass+'"></i><span class="'+f.nameclass+'">'+f.comname+"</span></div></li>";c+="</ul></div>"}g=this.options.coms.find("div.scrollspy-tool:first"),g.html(c),h=$.getTimeStamp(),g.find("li").each(function(){$(this).mousedown(function(b){var c=$.getTimeStamp();return 500>c-h?!1:(h=$.getTimeStamp(),1==a.options.status||a.options.moving?!1:(1==a.moveBoxType?a.$comBox=a.$contentBox:2==a.moveBoxType&&(a.$comBox=a.$footerBox),null!=a.$comBox&&a._eLeftComMouseDown(b,a,$(this)),!1))})}).mouseup(function(){$(this).css("visibility","")})},_getScrollTop:function(){return this.$body.scrollTop()>0?this.$body.scrollTop():this.$doc.scrollTop()>0?this.$doc.scrollTop():0},_eLeftComMouseDown:function(a,b,c){var d,e,f,g,h,i;(1==a.button||0==a.button)&&(this._clearFun(),this.options.moving=!0,this.moveType=0,this.$body.addClass("noChoose"),this.$topBody.addClass("noChoose"),1==this.moveBoxType&&(this.$comBox=this.$contentBox,d=this._getScrollTop(),e=0,f=this.$comBox.offset(),0==d&&(e=f.top-d-10,$("html,body").animate({scrollTop:e},500)),g=this.$comBox.find("div:first-child"),this.$firstChild=null,g.length>0&&g.hasClass("main-empty-notice-b")&&(this.$firstChild=g,this.$firstChild.hide(),this.$body.append(this.$firstChild))),this._initBaffle(this.$comBox),this.$baffle.show(),this.$curCom=c,this.$curCom.css("visibility","hidden"),this.$moveMask.css({width:"96px",height:"70px"}),this.$moveMask.html(this.$curCom.html()),h=b.$curCom.offset(),this.options.mouseLeft=a.pageX-h.left,this.options.mouseTop=a.pageY-h.top,this.$moveMask.css({left:h.left,top:h.top}).show(),this.iframeLeft=237,this.iframeTop=40,i=function(){b.$topBody.unbind("mousemove"),b.$body.unbind("mousemove"),b.$topBody.mousemove(function(a){return b.options.moving?(b.$moveMask.css({left:a.pageX-b.options.mouseLeft,top:a.pageY-b.options.mouseTop}),b._checkComMousePos(a),void 0):!1
}),b.$body.mousemove(function(a){return b.options.moving?(b.$moveMask.css({left:a.pageX-b.options.mouseLeft+b.iframeLeft,top:a.pageY-b.options.mouseTop-b._getScrollTop()+b.iframeTop}),void 0):!1})},i(),this.$topBody.on("mouseup",function(){return b.options.moving=!1,b._eComMouseDrop(b),!1}))},_eComMainMouseDown:function(a,b,c){var d,e;this._clearFun(),this.moveType=1,this.$curCom=c,this.$curCom.css("visibility","hidden"),this.$innerMoveMask.html('<div style="text-align:left">'+this.$curCom.html()+"</div>"),this.$body.addClass("noChoose"),this.$topBody.addClass("noChoose"),this._initBaffle(b.$comBox),this.$baffle.show(),d=this.$curCom.offset(),this.options.mouseLeft=a.pageX-d.left,this.options.mouseTop=a.pageY-d.top,this.$innerMoveMask.css({width:this.$curCom.width()}),this.$innerMoveMask.css({left:d.left,top:d.top}).show(),this.options.moving=!0,this.iframeLeft=0,this.iframeTop=0,e=function(){b.$body.unbind("mousemove"),b.$body.mousemove(function(a){return b.options.moving?(b.$innerMoveMask.css({left:a.pageX-b.options.mouseLeft,top:a.pageY-b.options.mouseTop}),b._checkComMousePos(a),!1):!1})},e(),this.$body.on("mouseup",function(){return b.options.moving=!1,b._eComMouseDrop(b),!1})},_eDocKeyDown:function(){var a=this;this.$doc.keydown(function(a){var b,c;8==a.keyCode?(c=a.srcElement||a.target,b="INPUT"==c.tagName.toUpperCase()||"TEXTAREA"==c.tagName.toUpperCase()||"H2"==c.tagName.toUpperCase()||"H5"==c.tagName.toUpperCase()||"H1"==c.tagName.toUpperCase()||"SPAN"==c.tagName.toUpperCase()||"U"==c.tagName.toUpperCase()||"DIV"==c.tagName.toUpperCase()?c.readOnly||c.disabled:!0):b=!1,b&&a.preventDefault()}),this.$element.on("click",function(){a.CloseAll()})},_eComMouseMove:function(a){var b=function(){a.$topBody.unbind("mousemove"),a.$body.unbind("mousemove"),a.$topBody.mousemove(function(b){return a.options.moving?(a.$moveMask.css({left:b.pageX-a.options.mouseLeft,top:b.pageY-a.options.mouseTop}),a._checkComMousePos(b),b.stopPropagation(),void 0):!1}),a.$body.mousemove(function(b){return a.options.moving?(a.$moveMask.css({left:b.pageX-a.options.mouseLeft+235,top:b.pageY-a.options.mouseTop+40}),void 0):!1})};b()},_checkComMousePos:function(a){return this._countPosFun(a,this.$comBox)?(this._findComPos(a,this.$comBox,0),void 0):(this.$posMask.hide(),this.options.status=0,!1)},_findComPos:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(c++,!this._countPosFun(a,b))return!1;if(d=null,e=!1,b.find("div:first").hasClass("div-padding")?d=b.find("div:first").children("div.li-div"):(d=b.children("div.li-div"),e=!0),null==d||0==d.length)return this._showPosMask(this.boxParm.left,this.boxParm.top,this.boxParm.width,2),this._setMoveResult(b,null,"top",!1),!0;if(e){if(f=$(d[0]),g=f.offset(),h=$(d[d.length-1]),i=h.offset(),0==this.moveType){if(a.pageY>this.boxParm.top-this._getScrollTop()+this.iframeTop&&a.pageY<=g.top-this._getScrollTop()+this.iframeTop&&a.pageX>=this.boxParm.left+this.iframeLeft&&a.pageX<=this.boxParm.left+this.boxParm.width+this.iframeLeft)return this._showPosMask(this.boxParm.left,g.top,this.boxParm.width,2),this._setMoveResult(b,f,"top",!1),!1}else if(1==this.moveType&&a.pageY>this.boxParm.top&&a.pageY<=g.top&&a.pageX>=this.boxParm.left&&a.pageX<=this.boxParm.left+this.boxParm.width)return this._showPosMask(this.boxParm.left,g.top,this.boxParm.width,2),this._setMoveResult(b,f,"top",!1),!1;if(0==this.moveType){if(a.pageY>i.top+h.outerHeight()-this._getScrollTop()+this.iframeTop&&a.pageY<=this.boxParm.top+this.boxParm.height-this._getScrollTop()+this.iframeTop&&a.pageX>=this.boxParm.left+this.iframeLeft&&a.pageX<=this.boxParm.left+this.boxParm.width+this.iframeLeft)return this._showPosMask(this.boxParm.left,h.top+h.outerHeight(),this.boxParm.width,2),this._setMoveResult(b,h,"bottom",!1),!1}else if(1==this.moveType&&a.pageY>i.top+h.outerHeight()&&a.pageY<=this.boxParm.top+this.boxParm.height&&a.pageX>=this.boxParm.left&&a.pageX<=this.boxParm.left+this.boxParm.width)return this._showPosMask(this.boxParm.left,h.top+h.outerHeight(),this.boxParm.width,2),this._setMoveResult(b,h,"bottom",!1),!1}if(j=!1,$.each(d,function(){return $(this).hasClass("col-li-div")?(j=!0,!1):void 0}),null!=d&&d.length>0&&!j)if(h=$(d[d.length-1]),i=h.offset(),0==this.moveType){if(a.pageY>h.top-this._getScrollTop()+this.iframeTop+h.outerHeight()&&a.pageY<=this.boxParm.top-this._getScrollTop()+this.boxParm.height+this.iframeTop&&a.pageX>=this.boxParm.left+this.iframeLeft&&a.pageX<=this.boxParm.left+this.boxParm.width+this.iframeLeft)return this._showPosMask(this.boxParm.left,i.top+h.outerHeight(),this.boxParm.width,2),this._setMoveResult(b,h,"bottom",!1),!1}else if(1==this.moveType&&a.pageY>i.top+h.outerHeight()&&a.pageY<=this.boxParm.top+this.boxParm.height&&a.pageX>=this.boxParm.left&&a.pageX<=this.boxParm.left+this.boxParm.width)return this._showPosMask(this.boxParm.left,i.top+h.outerHeight(),this.boxParm.width,2),this._setMoveResult(b,h,"bottom",!1),!1;for(k=0;k<d.length;k++)if(l=$(d[k]),l.hasClass("col-li-div")){for(s=l.find("td.td-w"),t=0;t<s.length;t++)if(this._findComPos(a,$(s[t]),c))return!1}else if(m=l.offset(),n=0,0==this.moveType?n=m.top-this._getScrollTop()+this.iframeTop:1==this.moveType&&(n=m.top),a.pageX>=m.left+this.iframeLeft&&a.pageX<=m.left+l.outerWidth()+this.iframeLeft&&a.pageY>=n&&a.pageY<=n+l.outerHeight()){switch(this.dropPos=a.pageX<=m.left+l.outerWidth()/3+this.iframeLeft?"left":a.pageX>=m.left+2*(l.outerWidth()/3)+this.iframeLeft?"right":a.pageY<=n+l.outerHeight()/2?"top":"bottom",a.pageY-n>=0&&a.pageY-n<=this.options.gap?this.dropPos="top":n+l.outerHeight()-a.pageY>=0&&n+l.outerHeight()-a.pageY<=this.options.gap&&(this.dropPos="bottom"),this.isNewBox=!1,("left"==this.dropPos||"right"==this.dropPos)&&(!b.hasClass("td-w")||b.hasClass("td-w")&&d.length>1)&&c<=this.options.layer&&(this.isNewBox=!0),this.options.status=1,this.$dropCom=l,this.$dropBox=b,o=m.top,p=m.left,q=l.outerWidth(),r=l.outerHeight(),this.dropPos){case"top":o=m.top,r=2;break;case"bottom":o=m.top+l.outerHeight(),r=2;break;case"left":p=m.left,q=2;break;case"right":p=m.left+l.outerWidth(),q=2}return this._showPosMask(p,o,q,r),!1}return!1},_showPosMask:function(a,b,c,d){this.$posMask.css({left:a,top:b,width:c,height:d}).show()},_setMoveResult:function(a,b,c,d){this.options.status=1,this.$dropBox=a,this.$dropCom=b,this.dropPos=c,this.isNewBox=d},_eComMouseDrop:function(a){var b,c,d,e,f;if(null!=this.$curCom&&this.$curCom.css("visibility",""),b=null,b=0==this.moveType?this.$moveMask:this.$innerMoveMask,0==this.options.status)c=this.$curCom.offset(),b.animate({left:c.left,top:c.top},100,function(){$(this).hide(),1==a.moveBoxType&&null!=a.$firstChild&&(a.$contentBox.append(a.$firstChild),a.$firstChild.show(),a.$firstChild=null),a._clearFun()});else if(1==this.options.status){switch(d=this.$posMask.offset(),e=d.left+this.iframeLeft,f=d.top-this._getScrollTop()+this.iframeTop,1==this.moveType&&(f=d.top),this.dropPos){case"top":case"bottom":e+=(this.$posMask.outerWidth()-b.outerWidth())/2,f-=(b.outerHeight()-this.$posMask.outerHeight())/2;break;case"left":case"bottom":e-=(b.outerWidth()-this.$posMask.outerWidth())/2,f+=(this.$posMask.outerHeight()-b.outerHeight())/2}b.animate({left:e,top:f},100,function(){$(this).hide(),a.$posMask.hide(),a._addCom()})}},_addCom:function(){var f,g,h,i,j,k,l,m,n,a={id:0,type_id:this.$curCom.attr("data-type"),pos_row:1,pos_column:1},b={},c={},d=this,e=this.$dropBox.attr("data-id");if(e=e&&"undefined"!=e?this.$dropBox.attr("data-id"):0,c["curboxid"]=e,c["droppos"]=this.dropPos,null!=this.$dropCom&&(c["dropcomid"]=this.$dropCom.attr("data-id")),"left"==this.dropPos||"right"==this.dropPos)if(this.isNewBox)b["id"]=0,b["config"]='[{"column":"1","width":"50"},{"column":"2","width":"50"}]',b["pos_row"]=1,b["pos_column"]=1,null!=this.$dropCom&&(b["pos_row"]=this.$dropCom.attr("data-row"),b["pos_column"]=this.$dropCom.attr("data-column"));else{for(b["id"]=e,f=$("#com_"+e).find("td[data-id="+e+"]"),g=f.length+1,h="",i=100/g,j=1;g>=j;j++)""!=h&&(h+=","),h+='{"column":"'+j+'","width":"'+i+'"}';b["config"]="["+h+"]"}if(null!=this.$dropCom&&(k=parseInt(this.$dropCom.attr("data-column")),l=parseInt(this.$dropCom.attr("data-row")),a["pos_column"]=k,a["pos_row"]=l,"right"==this.dropPos&&(a["pos_column"]=k+1),"bottom"==this.dropPos&&(a["pos_row"]=l+1)),1==this.moveType){if(a["id"]=this.$curCom.attr("data-id"),a["id"]==c["dropcomid"])return this._clearFun(),!1;m=this.$curCom.parents("td.td-w[data-id]:first"),m.length>0&&1==m.find("div.li-div[data-id]").length&&(n=m.parents("div.col-li-div[data-id]:first"),a["box_id"]=n.attr("data-id"),a["box_column"]=n.find("td.td-w[data-id="+a["box_id"]+"]").length,a["cur_column"]=this.$curCom.attr("data-column"))}this._cacheNewComData(c,b,a,function(e){d._initAddCom(d,a,b,c,e),1==d.moveType&&a["box_id"]>0&&d._deleteInitBox(parseInt(a["box_id"])),2==d.moveBoxType&&d._initBaffle(d.$footerBox)})},_initAddCom:function(a,b,c,d,e){var j,k,l,m,n,f=e.id,g=e.parent_id,h=!1,i=null;switch(0==this.moveType?(h=!0,i=a._getComHtml(),i=$('<div class="li-div" id="com_'+f+'" data-id="'+f+'" data-type="'+this.$curCom.attr("data-type")+'" data-row="'+b["pos_row"]+'" data-column="'+b["pos_column"]+'">'+i+"</div>")):i=this.$curCom,l=!1,("left"==a.dropPos||"right"==a.dropPos)&&(this.isNewBox?(j=$("<div></div>").attr({id:"com_"+g,"class":"li-div col-li-div","data-id":g,"data-type":COMPONENTTYPE.FRAME,"data-row":c["pos_row"],"data-column":c["pos_column"]}),j.append('<div class="col-table"><table class="div-table" cellspacing="0" cellpadding="0" border="0" width="100%"><tr><td class="td-w" width="50%" data-id="'+g+'"><div class="div-padding"></td><td class="td-w" width="50%" data-id="'+g+'"><div class="div-padding"></td></tr></table></div>'),k=j.find("div.div-padding"),"left"==a.dropPos?(a.$dropCom.attr("data-column",2),a.$dropCom.attr("data-row",1),$(k[0]).append(i)):(a.$dropCom.attr("data-column",1),a.$dropCom.attr("data-row",1),$(k[1]).append(i))):(l=!0,j=a.$dropCom.parents("div.col-li-div:first"),m=j.find("div.li-div[data-column]"),$.each(m,function(){var a=parseInt($(this).attr("data-column"));a>=b["pos_column"]&&$(this).attr("data-column",a+1)}),k=$('<td class="td-w" data-id="'+c["id"]+'"><div class="div-padding"></div></td>'),k.find(".div-padding").append(i))),this.dropPos){case"top":case"bottom":null==a.$dropCom?(a.$dropBox.find("div:first").hasClass("div-padding")?"top"==a.dropPos?a.$dropBox.find("div:first").prepend(i):a.$dropBox.find("div:first").append(i):"top"==a.dropPos?a.$dropBox.prepend(i):a.$dropBox.append(i),a.$dropCom=i):"top"==a.dropPos?$(i).insertBefore(a.$dropCom):$(i).insertAfter(a.$dropCom),j=a.$dropCom.parents("div.col-li-div:first");break;case"left":case"right":a.isNewBox?(j.insertBefore(a.$dropCom),"left"==a.dropPos?$(k[1]).append(a.$dropCom):$(k[0]).append(a.$dropCom)):(n=a.$dropCom.parents("td.td-w:first"),"left"==a.dropPos?$(k).insertBefore(n):"right"==a.dropPos&&$(k).insertAfter(n))}h&&a._initBindComEvent(a,i),j&&a._initTableBox(a,j,l),a._clearFun(),a._autoImage()},_initBindComEvent:function(a,b){b.each(function(){$(this).hover(function(){return a.options.moving||a.options.deleting||a.options.copying||a.options.disable||a.options.editing?!1:($(this).hasClass("col-li-div")||($(this).attr("class","li-div li-div-hover"),1==a.moveBoxType?a.$doWindow.find("div.moveto-b:first").show():2==a.moveBoxType&&a.$doWindow.find("div.moveto-b:first").hide(),a.$doWindow.insertBefore($(this).find("div:first")).show()),void 0)},function(){return a.options.deleting||a.options.copying||a.options.disable||a.options.editing?!1:($(this).removeClass("li-div-hover"),a.$doWindow.hide(),a.$deleteAlert.hide(),void 0)})}),a._bindComEdit(b)},_initTableBox:function(a,b,c){var d,f,g,h,i,j,k,l,m,n,o,p,q;if(b.length>0){for(d=b.attr("data-id"),this._getComInfo(d),b.find("div.divider-w[data-id="+d+"]").remove(),f=b.find("td.td-w[data-id="+d+"]"),g=0;g<f.length;g++)c&&$(f[g]).attr({"data-column":g+1,"data-id":d,width:100/f.length+"%"}),g<f.length-1&&b.append('<div class="divider-w" data-id="'+d+'" style="cursor:e-resize;top:0;left:0"></div>');h=null,i=null,j=null,k=0,l=b.offset(),m=0,n=function(){var c,b="";for(c=0;c<f.length;c++)b+=(""!=b?",":"")+'{"column":"'+(c+1)+'","width":"'+$(f[c]).attr("width").replace("%","")+'"}';b="["+b+"]",a.saveComID=d,a._cacheComData("config",b)},o=function(){a.options.moving=!1,a.$body.removeClass("noChoose"),a.$doc.off("mousemove mouseup"),null!=a.docTime&&(clearInterval(a.docTime),a.docTime=null),i.css("cursor","auto"),j.css("cursor","auto"),n()},p=function(){a.$doc.off("mousemove mouseup"),a.$doc.on("mousemove",function(a){var f,b=i.offset(),c=j.offset(),d=a.pageX-b.left,e=c.left+j.width()-a.pageX;return 50>d&&(d=50,e=m-50),50>e&&(e=50,d=m-50),f=b.left-l.left+d,h.css("left",f),i.attr("width",100*(d/k)+"%"),j.attr("width",100*(e/k)+"%"),!1}).on("mouseup",function(){return o(),!1}),a.docTime=setTimeout(p,50)},f.length>1&&(q=b.find("div.divider-w[data-id="+d+"]"),q.each(function(){$(this).off("mousedown").hover(function(){return a.options.moving||a.options.disable?!1:($(this).addClass("divider-w-move"),void 0)},function(){return a.options.moving||a.options.disable?!1:($(this).removeClass("divider-w-move"),void 0)}).mousedown(function(){var c,d;return a.options.moving||a.options.disable?!1:(a.$body.addClass("noChoose"),h=$(this),c=q.index(h),d=$(h.prevAll("div.col-table:first")).find("td.td-w[data-id="+h.attr("data-id")+"]"),d.length>0&&(a.options.moving=!0,i=$(d[c]),j=$(d[c+1]),i.css("cursor","e-resize"),j.css("cursor","e-resize"),k=b.find("table.div-table:first").width(),m=i.width()+j.width(),p()),void 0)})}).mouseup(function(){return a.options.disable?!1:(o(),!1)}).css("visibility","hidden"))}b.off("mouseenter mouseleave").hover(function(){var b,c,d,e,f,g;if(a.options.moving||a.options.copying||a.options.deleting||a.options.editing||a.options.disable)return!1;for(b=$(this),c=b.attr("data-id"),d=b.find("div.divider-w[data-id="+c+"]"),e=b.find("td.td-w[data-id="+c+"]"),f=0,g=0;g<e.length-1;g++)f+=$(e[g]).width(),$(d[g]).css("left",f-14);d.css({visibility:"visible",height:b.height()})},function(){return a.options.moving||a.options.copying||a.options.deleting||a.options.editing||a.options.disable?!1:($(this).find("div.divider-w[data-id="+$(this).attr("data-id")+"]").css("visibility","hidden"),void 0)})},_bindComEdit:function(a){var b=parseInt(a.attr("data-type"));switch(b){case COMPONENTTYPE.TITLE:this._initTitleBar(this,a);break;case COMPONENTTYPE.TEXT:this._initTextBar(this,a,a.find("div.w-text:first"),b);break;case COMPONENTTYPE.RICHTXT:this._initRichTextBar(this,a);break;case COMPONENTTYPE.BUTTON:this._initButtonBar(this,a);break;case COMPONENTTYPE.DIVIDER:this._initDividerBar(this,a);break;case COMPONENTTYPE.SPACER:this._initSpacerBar(this,a);break;case COMPONENTTYPE.SEARCH:this._initSearchBar(this,a);break;case COMPONENTTYPE.IMAGE:this._initImageBar(this,a);break;case COMPONENTTYPE.GALLERY:this._initGalleryBar(this,a);break;case COMPONENTTYPE.SLIDESHOW:this._initSlideShowBar(this,a);break;case COMPONENTTYPE.CODE:this._initCodeBar(this,a);break;case COMPONENTTYPE.MAP:this._initMapBar(this,a);break;case COMPONENTTYPE.PRODUCT:this._initProductBar(this,a);break;case COMPONENTTYPE.FLASH:this._initFlashBar(this,a);break;case COMPONENTTYPE.FILE:this._initFileBar(this,a);break;case COMPONENTTYPE.VIDEOLINK:this._initVideoLinkBar(this,a);break;case COMPONENTTYPE.PRODUCT:this._initProductBar(this,a);break;case COMPONENTTYPE.ARTICLE:this._initArticleBar(this,a);break;case COMPONENTTYPE.SOCIALICONS:this._initSocialIconsBar(this,a)}},_getComHtml:function(){var a="",b=parseInt(this.$curCom.attr("data-type"));switch(b){case COMPONENTTYPE.TITLE:a=getWebTitle(HOSTCONFIG.THEME_TITLE);break;case COMPONENTTYPE.TEXT:a='<div class="w-edit-com w-text" contenteditable="true" data-empty="1">点击编辑文本</div>';break;case COMPONENTTYPE.RICHTXT:a='<div class="w-edit-com w-text" data-empty="1">点击编辑富文本</div>';break;case COMPONENTTYPE.BUTTON:a='<div class="w-edit-com w-button"><div class="btn-default-b btn-default-w w-btn-large-w"><span class="btn-inner">按钮名称</span></div></div>';break;case COMPONENTTYPE.DIVIDER:a='<div class="w-edit-com w-delimiters-hor" style="margin:9px auto;"><hr class="delimiters" style="margin:0 auto;"></div>';break;case COMPONENTTYPE.SPACER:a='<div class="w-edit-com w-space space-b noChoose" style="height:40px;"><span>间隔</span><div class="stretch-b"></div></div>';break;case COMPONENTTYPE.SEARCH:a='<div class="w-edit-com w-searchbox"><div class="search-w search-defaut-w"><input type="text" placeholder="搜索内容" class="input-text-w input-search-w"><div class="btn-default-w search-btn-w"><span class="btn-inner">查询</span></div></div></div>';break;case COMPONENTTYPE.IMAGE:a='<div class="w-edit-com w-simImg" style="cursor:pointer"><div class="image-empty"><a title="点击上传"><img src="/images/images-empty.png"></a></div></div>';break;case COMPONENTTYPE.GALLERY:a='<div class="w-edit-com w-multi-imgs" style="cursor:pointer"><div class="image-empty"><a title="点击上传"><img src="/images/gallery-empty.png"></a></div></div>';break;case COMPONENTTYPE.SLIDESHOW:a='<div class="w-edit-com w-slide"><div class="image-empty"><a title="点击上传"><img src="/images/gallery-empty.png"></a></div></div>';break;case COMPONENTTYPE.CODE:a='<div class="w-edit-com w-code"><div class="custom-code"><div class="code-info">点击设置代码</div></div></div></div>';break;case COMPONENTTYPE.MAP:a='<div class="w-edit-com w-map"><div class="map"><iframe  id="gframe_'+$.getTimeStamp()+'" allowtransparency="true" frameborder="0" scrolling="no" style="width:100%; height:250px;" src="/js/editor/bar/baidumap.html"></iframe><div class="maptop" style="width:100%;left:0;top:0;height:250px;position:absolute;"></div></div></div>';break;case COMPONENTTYPE.PRODUCT:a='<div class="w-edit-com w-product clearfix"><div class="image-empty"><img src="/images/adprd-empty.png"/></div></div>';break;case COMPONENTTYPE.ARTICLE:a='<div class="w-edit-com w-adNews w-adNews1"><div class="image-empty"><img src="/images/news-empty.png"/></div></div>';break;case COMPONENTTYPE.FLASH:a='<div class="w-edit-com w-flash"><div class="w-flash-empty"></div></div>';break;case COMPONENTTYPE.FILE:a='<div class="w-edit-com w-file"><a class="clearfix" href="javascript:void(0)"><span style=" float:left;margin-right:1em;" class="w-file-img"><img src="../../images/file.png"></span><span class="w-file-info"><span class="w-file-name">文件名称</span><span class="w-file-down" style="display:none;">下载文件</span></span></a></div>';break;case COMPONENTTYPE.VIDEOLINK:a='<div class="w-edit-com w-video"><div class="w-video-in"><div class="w-video-notUpload w-video-click"><div class="w-video-info"><div class="w-video-uploading-img"><img src="../../images/video-click.png"/></div></div></div></div></div>';break;case COMPONENTTYPE.SOCIALICONS:a='<div class="w-edit-com w-social"><div class="w-social-in"><a href="javascript:void(0);" class="social-item social-facebook"  data-value="1"><i class="icon-social icon-social-facebook"></i></a><a href="javascript:void(0);" class="social-item social-twitter" data-value="2"><i class="icon-social icon-social-twitter"></i></a><a href="javascript:void(0);" class="social-item social-instagram" data-value="3"><i class="icon-social icon-social-instagram"></i></a><a href="javascript:void(0);" class="social-item social-linkedin" data-value="4"><i class="icon-social icon-social-linkedin"></i></a><a href="javascript:void(0);" class="social-item social-mail" data-value="5"><i class="icon-social icon-social-mail"></i></a></div></div>'}return a},_initTitleBar:function(a,b){var c=null,d=function(a,b){var d="",e="";switch(a){case"title-font":e="title",d="font-family";break;case"title-size":e="title",d="font-size";break;case"title-weight":e="title",d="font-weight";break;case"title-style":e="title",d="font-style";break;case"sub-title-font":e="subtitle",d="font-family";break;case"sub-title-size":e="subtitle",d="font-size";break;case"sub-title-weight":e="subtitle",d="font-weight";break;case"sub-title-style":e="subtitle",d="font-style"}return""==d?!1:(c.each(function(){return $(this).attr("data-type")==e?($(this).css(d,b),!1):void 0}),void 0)},e=function(b){a.$comBar.titleBar=a._initBaseWinBar(a,b,a.$comBar.titleBar,COMPONENTTYPE.TITLE,null,function(a,c,d){f(a,b,c,d)},function(a,b,c){"com-css"==a&&d(b,c)})},f=function(b,d){var i,j,k,l,m,n,g=a._getComInfo();c=d.find("[data-type]"),i=b.find('input[type="button"]'),j=b.find("#com_title_subTitle"),k=b.find("#com_title_subTitleStyle"),l=b.find("#com_title_more"),j.hide(),k.hide(),l.hide(),c.each(function(){"subtitle"==$(this).attr("data-type")&&(k.show(),j.show()),"link"==$(this).attr("data-type")&&l.show()}),m=function(a,b){c.each(function(){return $(this).attr("data-type")==a?($.isEmpty(b)&&"title"==a&&(b="标题名称"),("title"==a||"subtitle"==a)&&$(this).text(b),"link"==a&&($.isEmpty(b)?$(this).hide():$(this).show()),!1):void 0})},i.unbind("click").click(function(){a.$comBar.titleBar.hide(),h(d,g)}),n=b.find("input.input-text-b"),$(n[0]).off("keyup").on("keyup",function(){a._cacheComData("name",$(this).val()),m("title",$(this).val())}).val(g.name),$(n[1]).off("keyup").on("keyup",function(){a._cacheComData("info",$(this).val()),m("subtitle",$(this).val())}).val(g.info),$(n[2]).off("keyup").on("keyup",function(){a._cacheComData("link",$(this).val()),m("link",$(this).val())}).val(g.link)},g=$("<div></div>"),h=function(b,e){var f=a.options.jsurl+"/bar/title_win.html";top.$.Loading(),g.load(f+"?t="+$.getTimeStamp(),null,function(){var j,k,l,m,n;top.$.UnLoading(),c=b.find("[data-type]"),j=a._getComConfig(),k=g.find(".styleBoxC-in:first").find("ul:first"),l=HOSTCONFIG.THEME_TITLE,m=g.find(".btn-green-b:first"),j&&j["title-type"]&&(l=j["title-type"]),n=function(){var a=k.find("li");a.removeClass("selected"),a.each(function(){$(this).attr("data-num")==l&&$(this).addClass("selected"),$(this).click(function(){a.removeClass("selected"),$(this).addClass("selected")})})},top.$.WinDialog(g,function(f,g){m.click(function(){var l,h=k.find("li.selected:first"),i=$(h).attr("data-num");a._cacheComConfig("title-type",i),b.html(getWebTitle(i,e)),c=b.find("[data-type]");for(l in j)d(l,j[l]);g.remove(),f.remove(),a._clearFun()}),$.WebRequest("/editor/com/titles",null,function(a){var c,b="";for(c=0;c<a.list.length;c++)b+='<li data-num="'+a.list[c].num+'"><div class="style-itemC"><img src="/template/title/images/title'+a.list[c].num+'.png"></div></li>';k.html(b),n(),m.show()})},function(){a._clearFun()})})};a._clearFun(),b.on("click",function(){return a.saveComID==$(this).attr("data-id")||a.options.disable?!1:(a._clearFun(),a.$curCom=$(this),a.saveComID=a.$curCom.attr("data-id"),e($(this)),!1)})},_initTextBar:function(a,b,c,d){var f,r,s,e=null,g=[{type:"button",data:[{type:"bold",name:"加粗","class":"glyphicon glyphicon-bold"},{type:"italic",name:"斜体","class":"glyphicon glyphicon-italic"},{type:"underline",name:"下划线","class":"icon-other icon-underline"}]},{type:"dropdown",data:[{type:"font-color",name:"选择颜色","class":"glyphicon glyphicon-text-color"}]},{type:"button",data:[{type:"removeformat",name:"删除格式","class":"icon-other icon-link"}]},{type:"button",data:[{type:"insertunorderedlist",name:"无序列表","class":"icon-other icon-ul"},{type:"insertorderedlist",name:"有序列表","class":"icon-other icon-ol"}]},{type:"dropdown",data:[{type:"text-align",name:"","class":"glyphicon glyphicon-align-left",sub:[{type:"justifyleft","class":"glyphicon glyphicon-align-left"},{type:"justifycenter","class":"glyphicon glyphicon-align-center"},{type:"justifyright","class":"glyphicon glyphicon-align-right"},{type:"justifyfull","class":"glyphicon glyphicon-align-justify"}]}]},{type:"button",data:[{type:"undo",name:"撤消","class":"icon-other icon-undo"},{type:"redo",name:"重做","class":"glyphicon glyphicon-share-alt"}]}],h=function(a,b){return $.each(b.data,function(b,c){$('<a href="javascript:void(0)"></a>').attr({"data-type":c.type,title:c.name}).append($("<span></span>",{"class":c.class})).appendTo(a)}),a},i=function(a,b){return $.each(b.data,function(b,c){var e,f,d=$('<div class="menu-down"></div>').attr({title:c.name}).append($("<span></span>",{"class":c.class}).attr("aria-hidden",!0)).append($('<span aria-hidden="true" class="glyphicon glyphicon-triangle-bottom small-down"></span>'));"font-color"==c.type?d.append('<div class="menu-sub" style="width:240px;"><div id="textCP"></div></div>'):c.sub&&(e=$('<div class="menu-sub"></div>'),f=$("<ul></ul>"),$.each(c.sub,function(a,b){f.append($('<li><a href="javascript:void(0)" data-type="'+b.type+'"><span class="'+b.class+'"></span></a></li>'))}),e.append(f),d.append(e)),d.appendTo(a)}),a},j=function(){e=$("<div></div>",{"class":"text-menubox-b"}).css({position:"absolute",top:"-25px","z-index":100});var a=$("<div></div>",{"class":"text-menubox-in-b clearfix"});$.each(g,function(b,c){switch(c.type){case"button":a=h(a,c);break;case"dropdown":a=i(a,c)}}),e.append(a).hide()},k=function(a,b,c){b=b||""+c||"",document.execCommand(a,0,b)},l=function(){var a=window.getSelection();return a.getRangeAt&&a.rangeCount?a.getRangeAt(0):void 0},m=function(){f=l(),a._cacheComData("info",c.html())},n=function(){var a=window.getSelection();f&&(o(),a.addRange(f))},o=function(){try{var a=window.getSelection();a.removeAllRanges()}catch(b){document.body.createTextRange().select(),document.selection.empty()}};null==this.$comBar.txtToolBar&&(j(),this.$comBar.txtToolBar=e,this.$comBar.txtToolBar.on("click",function(){return c.focus(),!1}),this.$body.append(this.$comBar.txtToolBar),r=this.$comBar.txtToolBar.find(".menu-sub:first"),s=this.$comBar.txtToolBar.find(".menu-down:first"),s.hover(function(){r.show()},function(){r.hide()}),this.$textColorBox=new dhtmlXColorPicker({parent:"textCP",closeable:!1,cancel:!1,color:"#01ef48",conf:{lang:"cn"}}),this.$textColorBox.attachEvent("onSelect",function(a){return r.hide(),n(),k("forecolor",a),m(),c.focus(),!1}),this.$textColorBox.attachEvent("onCancel",function(){r.hide()})),a._clearFun(),b.click(function(){return c.focus(),a.saveComID==$(this).attr("data-id")||a.options.disable?!1:(a._clearFun(),a.$curCom=$(this),a.saveComID=$(this).attr("data-id"),1==c.attr("data-empty")&&c.html(""),c.noteTxt({saveFun:function(){var b=c.html();c.attr("data-empty",$.isEmpty(b)?1:0),a._cacheComData("info",b)}}),c.off("keyup").on("keyup",function(){var b=$(this).html();$(this).attr("data-empty",$.isEmpty(b)?1:0),a._cacheComData("info",b)}),!1)})},_initBaseWinBar:function(a,b,c,d,e,f,g){var i,j,k,l,h=null;return this.saveComID=b.attr("data-id"),i=function(){return null==c?(h=$("<div></div>",{"class":"pop-down-b pop-down-gray-b line-pop-b"}),a._getBarHtml(h,d,e,function(b){h=b,d==COMPONENTTYPE.SLIDESHOW&&null!=e?a.$topBody.append(h):a.$body.append(h),j()})):(h=c,j()),h.off("click").on("click",function(){var a=$(this).find(".select-option");return a.slideUp(),$(this).find(".select-icon").removeClass("select-down"),!1}),h},j=function(){var m,n,o,p,q,r,s,t,u,c=h.find(".slide-list li[data-tab]"),d=h.find(".pop-div-w250").hide(),i=b.find(".w-edit-com:first"),j=a._getComConfig();c.each(function(){$(this).off("click").on("click",function(){d.hide(),$(d[c.index($(this))]).show()})}),m=h.find("li[data-type=com-link]"),m.length>0&&(n=0,o=m.find("input[type=radio]"),p=$(m[0]).find("label[data-type=link-open]"),null==e&&j&&j["link-type"]&&(n=parseInt(j["link-type"])),$(o[n]).prop("checked",!0),m.each(function(){$(this).off("click").on("click",function(){return $(this).find("input[type=radio]").prop("checked",!0),null==e&&a._cacheComConfig("link-type",$(this).attr("data-value")),!1})}),p.find("input").removeClass("checked"),p.off("click").on("click",function(){var b=0,c=$(this).find("input");c.hasClass("checked")||(b=1),c.toggleClass("checked"),null==e&&a._cacheComConfig("link-open",b)}),j&&j["link-open"]&&1==j["link-open"]&&p.find("input").addClass("checked"),q=$(m[0]).find("input[data-type=link-url]"),q.off("keyup").on("keyup",function(){null==e&&a._cacheComConfig("link-url",$(this).val())}),q.val(""),j&&j["link-url"]&&q.val(j["link-url"]),r=function(a,b){var d,c="";for(d=0;d<SITEMENUS.length;d++)SITEMENUS[d].parent_id==a&&4!=SITEMENUS[d].type&&(c+='<div data-value="'+SITEMENUS[d].id+'"><span>'+s(b)+SITEMENUS[d].name+"</span></div>",c+=r(SITEMENUS[d].id,b+1));return c},s=function(a){var b,c;if(1==a)return"";for(b="",c=1;a>c;c++)b+="&nbsp;&nbsp;";return b+"-&nbsp;"},t=$(m[1]).find("div[data-type=inner-link]"),t.attr("data-value","").text("无"),u=$(m[1]).find("div[data-type=link-item]"),u.html('<div data-value=""><span>无</span></div>'),null!=SITEMENUS&&u.append(r(0,1))),k(i,j,function(b,c,d){"inner-link"==b&&null==e&&($(m[1]).find("input[type=radio]").prop("checked",!0),a._cacheComConfig("link-type",1),a._cacheComConfig("link-menuid",d)),"function"==typeof g&&g(b,c,d)}),"function"==typeof f&&f(h,i,j),null==e&&l()},k=function(b,c,d){var e=h.find("div.select-box"),f=h.find(".select-option"),g=h.find(".select-icon");e.each(function(){var j,k,l,m,n,o,p,q,h=$(this),i=e.index(h);h.parent().parent().css({"z-index":999-i}),h.css({"z-index":999-i,position:"relative"}),j=h.find(".select-dt:first"),k=j.find(".selected:first"),l=j.find(".select-icon:first"),m=h.find(".select-option:first"),n=m.children(),o=k.attr("data-style"),o&&!$.isEmpty(o)&&(p=k.attr("data-style"),q=$(n[0]).attr("data-value"),$(n[0]).text(),k.attr("data-default")&&(q=k.attr("data-default")),null!=c&&c[p]&&(q=c[p]),k.attr("data-value",q),$.each(n,function(){return $(this).attr("data-value")==q?(k.html($(this).text()),!1):void 0})),m.hide(),j.off("click").on("click",function(){return l.hasClass("select-down")?(l.removeClass("select-down"),m.slideUp()):(f.slideUp(),g.removeClass("select-down"),l.addClass("select-down"),m.slideDown()),!1}),n.off("click").on("click",function(){var c,e,f;return k.attr("data-value",$(this).attr("data-value")).text($(this).text()),m.slideUp(),l.removeClass("select-down"),c=k.attr("data-type"),e=$(this).attr("data-value"),f=k.attr("data-style"),null!=b&&"com-css"==c&&(("padding-top"==f||"padding-bottom"==f||"padding-left"==f||"padding-right"==f)&&(e+="px"),b.css(f,e),a._cacheComConfig(f,$(this).attr("data-value"))),"function"==typeof d&&d(c,f,e),!1})})},l=function(){var a=b.offset();h.show().css({left:a.left,top:a.top-h.outerHeight()-5})},i()},_initUpImgWin:function(a,b){var c=this,d=function(d,e,f){var g=a.find("div.w-edit-com:first");f==c.upImgType.UP&&(e=HOSTCONFIG.WEB_URL+e),"function"==typeof b&&b(g,d,e,f)},e=function(){var a=c.options.jsurl+"/bar/up_image_win.html",b=$("<div></div>");top.$.Loading(),b.load(a+"?t="+$.getTimeStamp(),null,function(){top.$.UnLoading(),top.$.WinDialog(b,function(a,e){b.find(".images-pop-menu li[data-tab]").click(function(){$(this).siblings().removeClass("cur"),$(this).addClass("cur");var a=$(this).attr("data-tab");b.find("div[id^='imagesFrom']").hide(),b.find("#imagesFrom"+a).show()}),top.$.onUpload({pick:{id:"#imageUpImg",label:"请选择您要上传的图片",multiple:!1},dnd:"#imageDragBox",disableGlobalDnd:!1},{uploadStart:function(){e.remove(),a.remove()},uploadFinished:function(){c._initUpLoading(0)},uploadProgress:function(a,b){c._initUpLoading(100*b)},uploadSuccess:function(a,b){"SUCCESS"==b.state?d(b.id,b.url,c.upImgType.UP):top.$.ShowResultMag("上传失败。",!1)}}),top.$("#comImageSearch").click(function(){var b=$.trim(top.$("#comImageSearchUrl").val());return $.isEmpty(b)?(top.$.ShowResultMag("请输入图片路径。",!1),!1):$.isImgUrl(b)?(d(0,b,c.upImgType.LINK),e.remove(),a.remove(),void 0):(top.$.ShowResultMag("请输入正确的图片路径。",!1),!1)})})})};e()},_initUpFileWin:function(a,b,c){var d=this,e=function(b,d,e){var f=a.find("div.w-edit-com:first");d=HOSTCONFIG.WEB_URL+d,"function"==typeof c&&c(f,b,d,e)},f=function(){var c,a=d.options.jsurl;a+=b==UPFILETYPE.FLASH?"/bar/up_flash_win.html":"/bar/up_file_win.html",c=$("<div></div>"),top.$.Loading(),c.load(a+"?t="+$.getTimeStamp(),null,function(){top.$.UnLoading(),top.$.WinDialog(c,function(a,c){var h,f={title:"File",extensions:b==UPFILETYPE.FLASH?"swf":"pdf,xla,xls,xlsx,xlt,xlw,doc,docx,rar,zip,txt",mimeTypes:"*"},g="/upload/uploadfile";b==UPFILETYPE.FLASH&&(g="/upload/uploadflash"),h=b==UPFILETYPE.FLASH?"请选择您要上传的Flash":"请选择您要上传的文件",top.$.onUpload({pick:{id:"#comFileUp",label:h,multiple:!1},server:g,dnd:"#comFileDragBox",accept:f,disableGlobalDnd:!1},{uploadStart:function(){c.remove(),a.remove()
},uploadFinished:function(){d._initUpLoading(0)},uploadProgress:function(a,b){d._initUpLoading(100*b)},uploadSuccess:function(a,b){"SUCCESS"==b.state?e(b.id,b.url,b.original):top.$.ShowResultMag("上传失败。",!1)}})})})};f()},_initRichTextBar:function(a,b){var c=null,d=function(b){var d=a.options.jsurl+"/bar/rich_text.html",e=$("<div></div>");a.saveComID=b.attr("data-id"),top.$.Loading(),e.load(d+"?t="+$.getTimeStamp(),null,function(){top.$.UnLoading(),top.$.WinDialog(e,function(d,f){var g=e.find("div.pop-edit-btns-b:first"),h=a._getCacheComData(b.attr("data-id"));c=top.UE.getEditor("comRichTextControl"),c.addListener("ready",function(){c.setContent(h["info"]?h["info"]:""),g.show()}),g.click(function(){var e=c.getContent();a._cacheComData("info",e),b.find("div.w-text:first").html(e),c=null,top.UE.getEditor("comRichTextControl").destroy(),d.remove(),f.remove()})},function(){c=null,top.UE.getEditor("comRichTextControl").destroy()})})};a._clearFun(),b.on("click",function(){return a.options.disable?!1:(a._clearFun(),a.$curCom=$(this),d($(this)),!1)})},_initButtonBar:function(a,b){var c=function(b){a.$comBar.buttonBar=a._initBaseWinBar(a,b,a.$comBar.buttonBar,COMPONENTTYPE.BUTTON,null,function(a,c,e){d(a,b,c,e)})},d=function(b,c,d,e){var g,h,f=d.children().eq(0);f.off("keyup").on("keyup",function(){a._cacheComData("name",$(this).text())}),g=b.find("div.btn-style-b"),g.each(function(){$(this).off("click").on("click",function(){f.attr("class",$(this).attr("data-class")),a._cacheComConfig("button-css",$(this).attr("data-value"))})}),h=b.find("span.btn-gray-black-b"),h.removeClass("btn-cur"),null!=e&&e["text-align"]?b.find("span.btn-gray-black-b[data-align="+e["text-align"]+"]").addClass("btn-cur"):$(h[0]).addClass("btn-cur"),h.each(function(){$(this).off("click").on("click",function(){h.removeClass("btn-cur"),$(this).addClass("btn-cur"),d.css("text-align",$(this).attr("data-align")),a._cacheComConfig("text-align",$(this).attr("data-align"))})}),$("#buttonBar_IsOpen").off("click").on("click",function(){$(this).hasClass("checked")?$(this).removeClass("checked"):$(this).addClass("checked")}),f.attr("contenteditable","true").focus()};a._clearFun(),b.on("click",function(){return a.saveComID==$(this).attr("data-id")||a.options.disable?!1:(a._clearFun(),a.$curCom=$(this),c($(this)),!1)})},_initDividerBar:function(a,b){var c=function(b){a.$comBar.dividerBar=a._initBaseWinBar(a,b,a.$comBar.dividerBar,COMPONENTTYPE.DIVIDER,null,function(a,c,e){d(a,b,c,e)},function(c,d,e){var f=b.find("div.w-edit-com");"hr-css"==c&&"width"==d&&(f.find("hr").css("width",e),a._cacheComConfig("width",e))})},d=function(b,c,d,e){var g,h,i,j,k,l,m,n;a._getComInfo(),g=b.find(".slide-list li[data-tab]"),h=b.find(".pop-div-w250"),i=g.find("input[type=radio]"),e&&e["type"]&&(1==e["type"]?$(i[0]).prop("checked",!0):$(i[1]).prop("checked",!0)),j=b.find("div[data-style=width]"),g.eq(2).off("click").on("click",function(){return $(i[0]).prop("checked",!0),$(i[1]).prop("checked",!1),d.removeClass("w-delimiters-ver").addClass("w-delimiters-hor"),d.css({"padding-left":"0px","padding-right":"0px"}),d.find("hr").css({magrin:"0 auto",height:"1px",width:j.attr("data-value")}),h.hide(),h.eq(2).show(),a._cacheComConfig("type",1),!1}),k=g.eq(3),l=b.find("input[data-style=height]"),m=b.find("input[data-style=padding-left]"),n=b.find("input[data-style=padding-right]"),k.off("click").on("click",function(){return $(i[0]).prop("checked",!1),$(i[1]).prop("checked",!0),d.removeClass("w-delimiters-hor").addClass("w-delimiters-ver"),d.css({"padding-left":m+"px","padding-right":n+"px"}),d.find("hr").css({height:(l.val()>0?l.val():100)+"px",width:"1px",magrin:"0 auto"}),h.hide(),h.eq(3).show(),a._cacheComConfig("type",2),!1}),e&&e["height"]&&l.val(e["height"]),l.unbind("keyup").keyup(function(){var b=$(this).val(),c=100;$.isEmpty(b)||(b>0?c=b:$(this).val(c)),d.find("hr").css("height",c+"px"),a._cacheComConfig("height",c)}),a.$colorBox=new dhtmlXColorPicker({parent:"dividerCP",closeable:!1,color:"#01ef48"}),a.$colorBox.attachEvent("onSelect",function(b){a._cacheComConfig("background-color",b),d.find("hr").css("background",b),h.eq(0).hide()}),a.$colorBox.attachEvent("onCancel",function(){h.eq(0).hide()})};a._clearFun(),b.click(function(){return a.saveComID==$(this).attr("data-id")||a.options.disable?!1:(a._clearFun(),a.$curCom=$(this),c($(this)),!1)})},_initSpacerBar:function(a,b){var f,g,c=b.find(".w-edit-com"),d=b.find(".stretch-b");b.on("click",function(){a.CloseAll()}),f=function(){a.$doc.off("mousemove mouseup"),a.$doc.on("mousemove",function(a){var d=b.offset(),e=a.pageY-d.top;20>e&&(e=20),c.height(e)}).on("mouseup",g)},g=function(){a.$doc.off("mousemove mouseup"),null!=a.docTime&&(clearInterval(a.docTime),a.docTime=null),a.saveComID=b.attr("data-id"),a._cacheComData("config",'{"height":"'+c.height()+'"}'),d.off("mouseup")},d.on("mousedown",function(){return a.options.disable?!1:(a.CloseAll(),f(),$(this).on("mouseup",g),void 0)})},_initSearchBar:function(a,b){var c=function(b){a.$comBar.searchBar=a._initBaseWinBar(a,b,a.$comBar.searchBar,COMPONENTTYPE.SEARCH,null,function(a,c,e){d(a,b,c,e)})},d=function(b,c,d,e){var h,f=a._getComInfo(),g=$("input.input-text-b");f["name"]&&$.isEmpty(f["name"])&&g.val(f["name"]),g.unbind("keyup").keyup(function(){var b=$(this).val();$.isEmpty(b)?d.find("input.input-text-w").attr("placeholder","search text"):d.find("input.input-text-w").attr("placeholder",b),a._cacheComData("name",b)}),h=b.find("span.btn-gray-black-b"),h.removeClass("btn-cur"),null!=e&&e["text-align"]?b.find("span.btn-gray-black-b[data-align="+e["text-align"]+"]").addClass("btn-cur"):$(h[0]).addClass("btn-cur"),h.each(function(){$(this).unbind("click").click(function(){h.removeClass("btn-cur"),$(this).addClass("btn-cur"),d.css("text-align",$(this).attr("data-align")),a._cacheComConfig("text-align",$(this).attr("data-align"))})})};a._clearFun(),b.click(function(){return a.saveComID==$(this).attr("data-id")||a.options.disable?!1:(a._clearFun(),a.$curCom=$(this),c($(this)),!1)})},_initImageBar:function(a,b){var c=!1,d=function(b){a.$comBar.imageBar=a._initBaseWinBar(a,b,a.$comBar.imageBar,COMPONENTTYPE.IMAGE,null,function(a,c,d){e(a,b,c,d)},function(c,d,e){var f=b.find("div.w-edit-com"),g=a.$comBar.imageBar.find('div[data-type="border-color-class"]');"border-class"==c&&(f.attr("class","w-edit-com w-simImg"),""!=e&&f.addClass(e).addClass(g.attr("data-value")),a._cacheComConfig("border-class",e)),"border-color-class"==c&&(f.removeClass("w-img-border-gray").removeClass("w-img-border-black"),f.addClass(e),a._cacheComConfig("border-color-class",e))})},e=function(b,c,d,e){var i,j,k,l,m,g=a._getComInfo(),h=b.find('input[type="button"]');h.unbind("click").click(function(){f(c)}),i=b.find("span.btn-gray-black-b"),i.removeClass("btn-cur"),null!=e&&e["text-align"]?b.find("span.btn-gray-black-b[data-align="+e["text-align"]+"]").addClass("btn-cur"):$(i[0]).addClass("btn-cur"),i.each(function(){$(this).unbind("click").click(function(){i.removeClass("btn-cur"),$(this).addClass("btn-cur"),d.css("text-align",$(this).attr("data-align")),a._cacheComConfig("text-align",$(this).attr("data-align"))})}),j=b.find("textarea.pop-textarea-b"),g["info"]&&j.val(g["info"]),j.unbind("keyup").keyup(function(){var b=d.find("div.w-img-caption"),c=$(this).val();$.isEmpty(c)&&1==b.length?b.remove():1==b.length?b.html(c):0==b.length&&d.append($("<div></div>",{"class":"w-img-caption"}).html(c)),a._cacheComData("info",$(this).val())}),k=b.find("input[data-type=name]"),k.val(g["name"]),k.unbind("keyup").keyup(function(){c.find(".image-w img").attr("alt",$(this).val()),a._cacheComData("name",$(this).val())}),l=0,e&&e["lightbox"]&&(l=e["lightbox"]),m=b.find("input[data-type=lightboxinput]"),m.removeClass("checked"),1==l&&m.addClass("checked"),b.find("label[data-type=lightbox]").off("click").on("click",function(){var b=0;m.hasClass("checked")?m.removeClass("checked"):(m.addClass("checked"),b=1),a._cacheComConfig("lightbox",b)})},f=function(b){a._initUpImgWin(b,function(b,d,e,f){var h,g=b.find("div.image-empty");0==g.length?b.find("img").attr("src",e):g.length>0&&(h=$('<div style="cursor:pointer"><div class="image-w"><a><img src="'+e+'"></a></div></div>'),b.append(h),g.remove()),a._cacheComData("resource_id",d>0?d:""),f==a.upImgType.UP?a._cacheComData("link",""):f==a.upImgType.LINK&&a._cacheComData("link",e),c&&(a.saveComID=0)})};b.click(function(){if(a.options.disable)return!1;if(0==$(this).find(".w-edit-com .image-empty:first").length){if(a.saveComID==$(this).attr("data-id"))return!1;c=!1,a.$curCom=$(this),a._clearFun(),d($(this))}else a.$curCom=$(this),a.saveComID=a.$curCom.attr("data-id"),c=!0,f($(this));return!1})},_initGalleryBar:function(a,b){var c=2,d=0,e=0,f=0,g=0,h=0,i=0,j=!1,k=function(b){a.$comBar.galleryBar=a._initBaseWinBar(a,b,a.$comBar.galleryBar,COMPONENTTYPE.GALLERY,null,function(a,c,d){m(a,b,c,d)},function(e,f,i){var j,k;r(b),"img-css"==e&&(j=b.find("div.gallery-mar"),j.css(f,i+"px"),g=i,l(b),a._cacheComConfig(f,i)),"img-column"==e&&(k=b.find("li"),k.css(f,100/i+"%"),c=i,l(b),a._cacheComConfig("column",i)),"thumbnail"==e&&a._cacheComConfig("thumbnail",i),"img-padding"==e&&(h=i,l(b),a._cacheComConfig("img-padding",i)),"cropping"==e&&(i!=d&&(d=i,l(b)),a._cacheComConfig("cropping",i))})},l=function(a){var b=a.find(".gallery-img-in img"),i=a.find(".gallery-border"),j=a.find(".gallery-aspectRatio");b.css({padding:0,"border-width":0}),i.css({padding:0,"border-width":0}),0==d?(b.css("padding",h),h>0&&b.css("border-width","1px")):(i.css("padding",h),h>0&&i.css("border-width","1px")),0==d||2==d?j.css("padding","0 0 75%"):j.css("padding","0 0 100%"),e=a.find(".multi-imgs li:first").width(),f=a.find(".multi-imgs li:first").height(),u(a,d,c,h,g,e,f)},m=function(b,h,j,k){var m,o,p;a._getComInfo(),i=h.width(),k&&(k["cropping"]&&(d=parseInt(k["cropping"])),k["column"]&&(c=parseInt(k["column"])),k["margin"]&&(g=parseInt(k["margin"]))),e=i/c,f=h.find(".multi-imgs li:first").height(),h.find(".gallery-tool-b").show(),h.find("span.glyphicon").removeClass("edited"),b.find("div[data-type=margin]").attr("data-value",g).html(g),m=b.find('input[type="button"]'),m.unbind("click").click(function(){n(h)}),o=0,k&&k["hover"]&&(o=k["hover"]),p=b.find("input[data-type=hoverinput]"),p.removeClass("checked"),1==o&&p.addClass("checked"),b.find("label[data-type=hover]").off("click").on("click",function(){var b=0;p.hasClass("checked")?p.removeClass("checked"):(p.addClass("checked"),b=1),a._cacheComConfig("hover",b)})},n=function(b){a._initUpImgWin(b,function(d,e,f){var j,k,m,n,p,h=d.find("div.image-empty"),i=$("<div></div>",{"class":"gallery-img"});i.append('<div class="gallery-mar"><a class="fancybox-thumbs" href="javascript:void(0);"><div class="gallery-border"><div class="gallery-aspectRatio"><div class="gallery-img-in"><img style="top:0px;left:0px;" src="'+f+'"></div></div></div></a></div>'),j=o(b,i),k=$("<li></li>").append(i).append(j).css("width",100/c+"%"),k.attr("data-resid",e).attr({"data-name":"","data-linktype":"0","data-linkurl":"","data-linkopen":"0","data-linkmenuid":""}),0==h.length?(m=d.find("div.multi-imgs ul"),m.append(k.append(j))):h.length>0&&(n=$("<div></div>",{"class":"multi-imgs"}),p=$("<ul></ul>").append(k),d.append(n.append(p)),h.remove()),t(b),l(b),a.CloseAll()})},o=function(b,c){var d=$("<div></div>",{"class":"gallery-tool-in-b"}),e=$("<div></div>",{"class":"gallery-tool-b"}),f=$('<span title="新增链接" aria-hidden="true" class="glyphicon glyphicon-link"></span>'),g=$('<span title="新增说明" aria-hidden="true" class="glyphicon glyphicon-comment"></span>'),h=$('<span title="删除图片" aria-hidden="true" class="glyphicon glyphicon-trash"></span>');return f.click(function(a){p(b,c,$(this)),a.stopPropagation()}),g.click(function(a){q(b,c,$(this)),a.stopPropagation()}),h.click(function(c){d.find("span").removeClass("edited"),h.addClass("edited"),1==b.find(".multi-imgs li").length?(b.find(".w-edit-com").html('<div class="image-empty"><a><img src="/images/gallery-empty.png"></a></div>'),t(b),a.CloseAll(),a.options.editing=!1):(r(b),h.parents("li:first").remove(),t(b)),c.stopPropagation()}),d.append(f).append(g).append(h),e.append(d),e},p=function(b,c,d){a.$curCom=b,a.$comBar.galleryLinkBar=a._initBaseWinBar(a,b,a.$comBar.galleryLinkBar,COMPONENTTYPE.GALLERY,1,function(a){var f,g,h,i,j,k,l;r(b),s(d,a),d.addClass("edited"),f=a.find("li[data-type=com-link]"),g=f.find("input[type=radio]"),h=$(f[0]).find("input.checkboxnew"),i=a.find("input[data-type=link-url]"),j=a.find("span.btn-blackGray"),$(g[c.attr("data-linktype")]).prop("checked",!0),1==c.attr("data-linkopen")?h.addClass("checked"):h.removeClass("checked"),i.val(c.attr("data-linkurl")),k=a.find("div[data-type=inner-link]"),$.isEmpty(c.attr("data-linkmenuid"))?k.attr("data-value","").html("无"):(k.attr("data-value",c.attr("data-linkmenuid")),k.html(a.find("div.select-option").find("div[data-value="+c.attr("data-linkmenuid")+"]").text())),j.off("click").click(function(){return c.attr("data-linktype",""),c.attr("data-linkurl",""),c.attr("data-linkopen",0),c.attr("data-linkmenuid",""),r(b),t(b),!1}),l=a.find("span.btn-green-b"),l.off("click").click(function(){var d=0;return $(g[1]).prop("checked")&&(d=1),c.attr("data-linktype",d),c.attr("data-linkurl",i.val()),c.attr("data-linkopen",h.hasClass("checked")?1:0),c.attr("data-linkmenuid",a.find("div[data-type=inner-link]").attr("data-value")),r(b),t(b),!1})},null)},q=function(b,c,d){r(b),a.$curCom=b,a.$comBar.galleryCaptionBar=a._initBaseWinBar(a,b,a.$comBar.galleryCaptionBar,COMPONENTTYPE.GALLERY,2,function(a){var h,i,f=a.find("textarea.pop-textarea-b:first"),g=c.attr("data-name");f.val(g),h=a.find("span.btn-blackGray"),h.unbind("click").click(function(){return r(b),!1}),i=a.find("span.btn-green-b"),i.unbind("click").click(function(){return c.attr("data-name",f.val()),$.isEmpty(f.val())?c.find(".gallery-caption").hide():c.find(".gallery-caption").show(),r(b),t(b),!1}),s(d,a),d.addClass("edited")})},r=function(b){b.find(".gallery-tool-in-b .glyphicon").removeClass("edited"),null!=a.$comBar.galleryCaptionBar&&a.$comBar.galleryCaptionBar.hide(),null!=a.$comBar.galleryLinkBar&&a.$comBar.galleryLinkBar.hide()},s=function(a,b){var c=a.offset();b.css({left:c.left-b.outerWidth()/2+10,top:c.top+a.outerHeight()+5}).show()},t=function(b){var c=[];b.find(".multi-imgs li").each(function(){var a=$(this),b="{";b+='"link-type":"'+a.attr("data-linktype")+'",',b+='"link-url":"'+a.attr("data-linkurl")+'",',b+='"link-open":"'+a.attr("data-linkopen")+'",',b+='"link-menuid":"'+a.attr("data-linkmenuid")+'"}',c[c.length]={name:a.attr("data-name"),resource_id:a.attr("data-resid"),config:b}}),a._cacheComData("items",c)},u=function(a,b,c,d,e,f,g){var k,l,m,h=a.find("div.gallery-img-in img"),i=function(a){var h,i,j,k,l,m,n,o,p,q,c=a.width();return c>0?(h=a.height(),i=100,j=0,k=0,0==b?(l=0,m=0,d>0&&(m+=2*(d+1)),e>0&&(l+=2*e),n=f-l,o=g-l,n>=c&&o>=h?(i="auto",j=100*((f-c)/2/f),k=100*((g-h)/2/g)):(h>o&&(c=o/h*c,h=o),c>f&&(h=f/c*h,c=f),i=100*(c/f)+"%",j=100*((f-c)/2/f),k=100*((g-h)/2/g)),a.css({width:i,left:j+"%",top:k+"%"})):(p=f-2*(d+1),q=h*(p/c),g>q?(c=g/h*c,i=100*(c/f),j=0-100*((c-f)/2/f)):(h=q,k=0-100*((h-g)/2/g)),a.css({width:i+"%",left:j+"%",top:k+"%"})),void 0):!1},j=function(){var a=parseInt(this.index);i($(h[a]))};for(k=0;k<h.length;k++)l=$(h[k]),l.css({width:"auto"}),m=new Image,m.onload=j,m.src=l.attr("src"),m.index=k},v=function(b){var j,k,l,m,n,p,c=b.attr("data-id");return a._getComInfo(c),j=a._getComConfig(c),k=b.find(".multi-imgs img"),0==k.length?!1:(l=.75,m=0,n=2,h=0,i=b.width(),j&&(j["cropping"]&&(m=parseInt(j["cropping"]),1==m&&(l=100)),j["column"]&&(n=parseInt(j["column"])),j["img-padding"]&&(h=parseInt(j["img-padding"])),j["margin"]&&(g=parseInt(j["margin"]))),e=i/n,p=b.find(".multi-imgs li"),f=$(p[0]).height(),u(b,m,n,h,g,e,f),p.each(function(){if(0==$(this).find("div.gallery-tool-b").length){var a=o(b,$(this));a.hide(),$(this).append(a)}}),void 0)};v(b),b.click(function(){if(a.options.disable)return!1;if(0==$(this).find(".w-edit-com .image-empty:first").length){if(a.saveComID==$(this).attr("data-id"))return!1;a._clearFun(),a.$curCom=$(this),j=!1,k($(this))}else a.$curCom=$(this),a.saveComID=a.$curCom.attr("data-id"),j=!0,n($(this));return!1})},_initSlideShowBar:function($self,com){var slideConfig,curComConfig,win=$("<div></div>"),slideImagePanel=null,comInner=null,isEmpty=!1,closeAllWin=function(){null!=$self.$comBar.slideLinkBar&&$self.$comBar.slideLinkBar.hide(),null!=$self.$comBar.slideCaptionBar&&$self.$comBar.slideCaptionBar.hide()},loadSetWin=function(curCom,type){var comSlideAddImg,url=$self.options.jsurl+"/bar/slide_images.html";comInner=curCom.find(".w-edit-com:first"),comSlideAddImg=function(){top.$.onUpload({pick:{id:"#comSlideAddImg",label:"新增图片",multiple:!1}},{uploadStart:function(){closeAllWin()},uploadFinished:function(){$self._initUpLoading(0)},uploadProgress:function(a,b){$self._initUpLoading(100*b)},uploadSuccess:function(a,b){"SUCCESS"==b.state?setImg(curCom,b.id,b.url):top.$.ShowResultMag("上传失败。",!1)}})},top.$.Loading(),win.load(url+"?t="+$.getTimeStamp(),null,function(response,status,xhr){var selectList,styleWin,upWin,imagesWin,comData,getImagesData;top.$.UnLoading(),"success"==status&&(selectList=win.find(".slide-select li"),selectList.each(function(){$(this).click(function(){selectList.removeClass("selected"),$(this).addClass("selected")})}),styleWin=win.find("#slide_win_style"),upWin=win.find("#slide_win_upimage"),imagesWin=win.find("#slide_win_images"),0==type?styleWin.show():(imagesWin.show(),comData=$self._getComInfo(),comData["items"]&&$.each(comData["items"],function(){var itemConfig,linkType=0,linkUrl="",linkOpen=0,linkMenuID="";$.isEmpty(this["config"])||(itemConfig=eval("("+this["config"]+")"),linkType=itemConfig["link-type"],linkUrl=itemConfig["link-url"],linkOpen=itemConfig["link-open"],linkMenuID=itemConfig["link-menuid"]),setImg(curCom,this["resource_id"],this["path"],this["name"],linkType,linkUrl,linkOpen,linkMenuID)})),styleWin.find(".pop-edit-btns-b").click(function(){var a=1,b=styleWin.find(".slide-select .selected");a=parseInt(b.attr("data-value")),$self._cacheComConfig("navstyle",a),styleWin.hide(),upWin.show(),imagesWin.hide(),top.$.onUpload({pick:{id:"#slideUpImg",label:"请选择您要上传的图片",multiple:!1},dnd:"#slideDragBox",disableGlobalDnd:!1},{uploadStart:function(){upWin.hide(),imagesWin.show(),comSlideAddImg()},uploadFinished:function(){$self._initUpLoading(0)},uploadProgress:function(a,b){$self._initUpLoading(100*b)},uploadSuccess:function(a,b){"SUCCESS"==b.state?(styleWin.hide(),upWin.hide(),setImg(curCom,b.id,b.url,"",0,"",0,""),imagesWin.show()):top.$.ShowResultMag("上传失败。",!1)}})}),top.$.WinDialog(win,function(a,b){0!=type&&comSlideAddImg(),imagesWin.find(".pop-edit-btns-b .btn-green-b").click(function(){a.remove(),b.remove(),closeImgEdit(curCom),getImagesData(),initSlidePlay(comInner),closeAllWin(),isEmpty&&($self.saveComID=0)})},function(){closeAllWin()}),getImagesData=function(){var a=slideImagePanel.find("li"),b=[];a.each(function(){var a=$(this),c="{";c+='"link-type":"'+a.attr("data-linktype")+'",',c+='"link-url":"'+a.attr("data-linkurl")+'",',c+='"link-open":"'+a.attr("data-linkopen")+'",',c+='"link-menuid":"'+a.attr("data-linkmenuid")+'"}',b[b.length]={name:a.attr("data-name"),resource_id:a.attr("data-resid"),path:a.attr("data-path"),config:c}}),$self._cacheComData("items",b)})})},setImg=function(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o;slideImagePanel=win.find("#slide_images_list"),i=$("<li></li>"),i.attr("data-resid",b).attr("data-path",c).attr({"data-name":d?d:"","data-linktype":e,"data-linkurl":f,"data-linkopen":g,"data-linkmenuid":h}),j=$("<div></div>",{"class":"gallery-img"}),j.append('<img src="'+HOSTCONFIG.WEB_URL+c+'">'),i.append(j),k=$("<div></div>",{"class":"gallery-tool-in-b"}),l=$("<div></div>",{"class":"gallery-tool-b"}),m=$('<span title="新增链接" aria-hidden="true" class="glyphicon glyphicon-link"></span>'),n=$('<span title="新增说明" aria-hidden="true" class="glyphicon glyphicon-comment"></span>'),o=$('<span title="删除图片" aria-hidden="true" class="glyphicon glyphicon-trash"></span>'),m.click(function(b){imgEditLink(a,i,$(this)),b.stopPropagation()}),n.click(function(b){imgEditCaption(a,i,$(this)),b.stopPropagation()}),o.click(function(a){closeAllWin(),i.remove(),a.stopPropagation()}),k.append(m).append(n).append(o),l.append(k),i.append(l),slideImagePanel.append(i)},initSlidePlay=function(a){var d,e,f,g,h,b=slideImagePanel.find("li img"),c=slideImagePanel.find("li");if(b.length>0){for(d='<div class="w-slide-page-num"><div class="w-page-bottom"><div class="w-slide-content"><div class="slide-panel">',e=0;e<b.length;e++)d+='<div class="slide-item"><div class="slide-item-div"><div class="slide-item-div-inner"><img src="'+$(b[e]).attr("src")+'" class="slide-img" />',f=$(c[e]).attr("data-name"),$.isEmpty(f)||(d+='<div class="slide-caption"><div class="slide-captionbg"></div><div class="slide-caption-text"><div class="slide-caption-text-in">'+$(c[e]).attr("data-name")+"</div></div></div>"),d+="</div></div></div>";d+='<div class="cycle-prev"></div><div class="cycle-next"></div></div></div></div></div>',a.html(d),g={ratio:"auto",style:"fade",speend:5,autoplay:1,showcotrols:1,captionpos:0,navstyle:0,navlocation:0,disabled:!0},h=$self._getComConfig(),h&&(h["ratio"]&&(g.ratio=h["ratio"]),h["style"]&&(g.style=h["style"]),h["speend"]&&(g.speend=parseInt(h["speend"])),h["autoplay"]&&(g.autoplay=parseInt(h["autoplay"])),h["showcotrols"]&&(g.showcotrols=parseInt(h["showcotrols"])),h["captionpos"]&&(g.captionpos=parseInt(h["captionpos"])),h["navstyle"]&&(g.navstyle=parseInt(h["navstyle"])),h["navlocation"]&&(g.navlocation=parseInt(h["navlocation"]))),$(a).slide("destroy").slide(g)}else a.html('<div class="image-empty"><a title="点击上传"><img src="/images/gallery-empty.png"></a></div>')},imgEditLink=function(a,b,c){$self.$comBar.slideLinkBar=$self._initBaseWinBar($self,a,$self.$comBar.slideLinkBar,COMPONENTTYPE.SLIDESHOW,1,function(d){var f,g,h,i,j,k,l;closeImgEdit(a),showImgEdit(c,d),d.css("z-index","1001"),c.addClass("edited"),f=d.find("li[data-type=com-link]"),g=f.find("input[type=radio]"),h=$(f[0]).find("input.checkboxnew"),i=d.find("input[data-type=link-url]"),j=d.find("span.btn-blackGray"),$(g[b.attr("data-linktype")]).prop("checked",!0),1==b.attr("data-linkopen")?h.addClass("checked"):h.removeClass("checked"),i.val(b.attr("data-linkurl")),k=d.find("div[data-type=inner-link]"),$.isEmpty(b.attr("data-linkmenuid"))?k.attr("data-value","").html("无"):(k.attr("data-value",b.attr("data-linkmenuid")),k.html(d.find("div.select-option").find("div[data-value="+b.attr("data-linkmenuid")+"]").text())),j.off("click").click(function(){return b.attr("data-linktype",""),b.attr("data-linkurl",""),b.attr("data-linkopen",0),b.attr("data-linkmenuid",""),closeImgEdit(a),!1}),l=d.find("span.btn-green-b"),l.off("click").click(function(){var c=0;return $(g[1]).prop("checked")&&(c=1),b.attr("data-linktype",c),b.attr("data-linkurl",i.val()),b.attr("data-linkopen",h.hasClass("checked")?1:0),b.attr("data-linkmenuid",d.find("div[data-type=inner-link]").attr("data-value")),closeImgEdit(a),!1})},function(){})},imgEditCaption=function(a,b,c){closeImgEdit(a),$self.$comBar.slideCaptionBar=$self._initBaseWinBar($self,a,$self.$comBar.slideCaptionBar,COMPONENTTYPE.SLIDESHOW,2,function(d){var f,h,i;d.css("z-index","1001"),f=d.find("textarea.pop-textarea-b:first"),b.find("img:first"),f.val(b.attr("data-name")),h=d.find("span.btn-blackGray"),h.unbind("click").click(function(){closeImgEdit(a)}),i=d.find("span.btn-green-b"),i.unbind("click").click(function(){b.attr("data-name",f.val()),closeImgEdit(a)}),showImgEdit(c,d),c.addClass("edited")})},closeImgEdit=function(){slideImagePanel.find(".gallery-tool-in-b .glyphicon").removeClass("edited"),null!=$self.$comBar.slideCaptionBar&&$self.$comBar.slideCaptionBar.hide(),null!=$self.$comBar.slideLinkBar&&$self.$comBar.slideLinkBar.hide()},showImgEdit=function(a,b){var c=a.offset();b.css({left:c.left-b.outerWidth()/2+a.outerWidth()/2+10,top:c.top+a.outerHeight()+2}).show()},initSlideBar=function(a){$self.$comBar.slideBar=$self._initBaseWinBar($self,a,$self.$comBar.slideBar,COMPONENTTYPE.SLIDESHOW,null,function(b,c){createSlideBar(b,a,c)},function(b,c,d){var e=a.find(".w-edit-com:first");"slide-config"==b&&(e.slide("option",c,d),$self._cacheComConfig(c,d))})},createSlideBar=function(a,b){var d=a.find('input[type="button"]');d.unbind("click").click(function(){loadSetWin(b,1)})};0==com.find(".w-edit-com .image-empty:first").length&&(slideConfig={ratio:"auto",style:"fade",speend:5,autoplay:1,showcotrols:1,captionpos:0,navstyle:0,navlocation:0,disabled:!0},curComConfig=$self._getComConfig(com.attr("data-id")),curComConfig&&(curComConfig["ratio"]&&(slideConfig.ratio=curComConfig["ratio"]),curComConfig["style"]&&(slideConfig.style=curComConfig["style"]),curComConfig["speend"]&&(slideConfig.speend=parseInt(curComConfig["speend"])),curComConfig["autoplay"]&&(slideConfig.autoplay=parseInt(curComConfig["autoplay"])),curComConfig["showcotrols"]&&(slideConfig.showcotrols=parseInt(curComConfig["showcotrols"])),curComConfig["captionpos"]&&(slideConfig.captionpos=parseInt(curComConfig["captionpos"])),curComConfig["navstyle"]&&(slideConfig.navstyle=parseInt(curComConfig["navstyle"])),curComConfig["navlocation"]&&(slideConfig.navlocation=parseInt(curComConfig["navlocation"]))),$(com.find(".w-edit-com:first")).slide(slideConfig)),com.click(function(){if($self.options.disable)return!1;if(0==$(this).find(".w-edit-com .image-empty:first").length){if($self.saveComID==$(this).attr("data-id"))return!1;$self._clearFun(),$self.$curCom=$(this),isEmpty=!1,initSlideBar($(this))}else $self.$curCom=$(this),isEmpty=!0,$self.saveComID=$self.$curCom.attr("data-id"),loadSetWin($(this),0);return!1})},_initCodeBar:function(a,b){var c=function(b){a.$comBar.codeBar=a._initBaseWinBar(a,b,a.$comBar.codeBar,COMPONENTTYPE.CODE,null,function(a,c,e){d(a,b,c,e)},function(){})},d=function(b,c,d,e){var h,i,j,f=d.find(".code-info:first"),g=d.find("textarea");0==g.length&&(g=$("<textarea></textarea>").css("height","150px").hide(),d.append(g)),f.hide(),h=function(){var a=f.html();"点击设置代码"==a?g.val(""):g.val(a),f.hide(),g.show().focus()},i=function(){var a=g.val();$.isEmpty(a)?f.html("点击设置代码"):f.html(a),g.hide(),f.show()},h(),g.off("keyup").on("keyup",function(){f.html($(this).val()),a._cacheComData("info",$(this).val())}),g.off("click").on("click",function(a){a.stopPropagation()}),b.find("input.btn-b").unbind("click").click(function(){h()}),j=b.find("span.btn-gray-black-b"),null!=e&&e["text-align"]?b.find("span.btn-gray-black-b[data-align="+e["text-align"]+"]").addClass("btn-cur"):$(j[0]).addClass("btn-cur"),j.each(function(){$(this).unbind("click").click(function(){j.removeClass("btn-cur"),$(this).addClass("btn-cur"),i(),d.css("text-align",$(this).attr("data-align")),a._cacheComConfig("text-align",$(this).attr("data-align"))})})};a._clearFun(),b.click(function(){return a.saveComID==$(this).attr("data-id")||a.options.disable?!1:(a._clearFun(),a.$curCom=$(this),a.saveComID=a.$curCom.attr("data-id"),c($(this)),!1)})},_initMapBar:function(a,b){var c=function(b){a.$comBar.mapBar=a._initBaseWinBar(a,b,a.$comBar.mapBar,COMPONENTTYPE.MAP,null,function(a,c){d(a,b,c)},function(b,c,d){"map-config"==b&&(e(a.$comBar.mapBar,a.$curCom.find(".w-edit-com")),a._cacheComConfig(c,d))})},d=function(b,c,d){var f=b.find("input[data-type=address]");f.unbind("keyup").keyup(function(){a._cacheComConfig("address",$(this).val()),e(b,d)})},e=function(a,b){var k,c=b.find("iframe:first"),d=b.find(".maptop:first"),e=a.find('div[data-style="width"]').attr("data-value"),f=a.find('div[data-style="height"]').attr("data-value"),g=a.find('div[data-style="zoom"]').attr("data-value"),h=a.find('div[data-style="marker"]').attr("data-value"),i=a.find("input[data-type=address]").val(),j=a.find('div[data-style="align"]').attr("data-value");"100%"!=e&&(e+="px"),$.isEmpty(f)||(f+="px"),k="/js/editor/bar/baidumap.html?width="+e+"&height="+f+"&zoom="+g+"&address="+i+"&marker="+h+"&align="+j,c.attr("src",k).css("height",f),d.css("height",f)};a._clearFun(),b.click(function(){return a.saveComID==$(this).attr("data-id")||a.options.disable?!1:(a._clearFun(),a.$curCom=$(this),c($(this)),!1)})},_getSortIndex:function(a){var c,b="|-";for(c=0;a>c;c++)b+="-";return b},_initProductBar:function(a,b){var e,f,g,h,c=function(b){a.$comBar.productBar=a._initBaseWinBar(a,b,a.$comBar.productBar,COMPONENTTYPE.PRODUCT,null,function(a,c,e){d(a,b,c,e)},function(){})},d=function(b){var i,f=a._getComInfo(),h=0;f&&f["choose"]>0&&(h=parseInt(f["choose"])),i=b.find("input.btn-green-b:first"),i.off("click").on("click",function(){g(f)})};a._clearFun(),e=function(){$.WebRequest("/editor/com/product",a._getComInfo(),function(a){b.html(a.html)})},f=$("<div></div>"),g=function(b){var c=a.options.jsurl+"/bar/product_win.html";top.$.Loading(),f.load(c+"?t="+$.getTimeStamp(),null,function(){top.$.UnLoading(),top.$.WinDialog(f,function(c,d){var g,h,i,j,k,l,m,n,o,p;a.saveComID=b["id"],g=f.find(".adpop-prd-list-b ul"),h=f.find("#com_product_sort"),i=f.find("input.btn:first"),j=f.find("input.input-text-b:first"),k=0,l="",m=1,n=1,o=function(){$.WebRequest("/editor/com/products",{sortid:k,name:l,pageindex:m},function(b){var h,f="";for(h=0;h<b.list.length;h++)f+='<li><div class="prd-cell"><div class="prd-h"><h3>'+b.list[h]["title"]+'</h3></div><div class="prd-cell-btn"><input value="选择" class="btn btn-green-b" type="button" data-productid="'+b.list[h]["id"]+'" /></div></div></li>';g.html(f),g.find("input").each(function(){$(this).click(function(){a._cacheComData("choose",$(this).attr("data-productid")),e(),d.remove(),c.remove(),a._clearFun()})})})},p=function(b,c,d,e){for(var f=0;f<c.length;f++)c[f]["parent_id"]==d&&(h.append('<option value="'+c[f]["id"]+"|"+b+'">'+a._getSortIndex(e+1)+c[f]["name"]+"</option>"),p(b,c,c[f]["id"],e+1));return!1},o(),$.WebRequest("/editor/com/product-sort",null,function(a){for(var b=0;b<a.systems.length;b++)h.append('<option value="'+a.systems[b]["id"]+'|0">'+a.systems[b]["name"]+"</option>"),p(a.systems[b]["id"],a.systems[b]["productCategories"],0,0)}),i.click(function(){k=h.val(),l=j.val(),m=1,n=1,o()})},function(){a._clearFun()})})},h=a._getComInfo(b.attr("data-id")),!h["add"]||null!=h["choose"]&&0!=h["choose"]||(a.saveComID=b.attr("data-id"),a.$curCom=$(b),g(h)),b.click(function(){return a.saveComID==$(this).attr("data-id")||a.options.disable?!1:(a._clearFun(),a.$curCom=$(this),c($(this)),!1)})},_initArticleBar:function(a,b){var c=null,d=null,e=null,f=null,g=function(b){a.$comBar.articleBar=a._initBaseWinBar(a,b,a.$comBar.articleBar,COMPONENTTYPE.ARTICLE,null,function(a,c,d){j(a,b,c,d)},function(b,c,d){("top-count"==b||"show-time"==b)&&(a._cacheComConfig(b,d),h())})},h=function(){$.WebRequest("/editor/com/article",a._getComInfo(),function(a){b.html(a.html)})},i=function(b){var g,i,j,d="";for(g=0;g<c.length;g++)if(b==c[g]["id"]){for(i=0;i<c[g]["articleCategories"].length;i++)d+='<div data-value="'+c[g]["articleCategories"][i]["id"]+'"><span>'+c[g]["articleCategories"][i]["name"]+"</span></div>";break}j=e.find(".select-option:first"),j.html(d),j.find("div").each(function(){$(this).off("click").on("click",function(){var b=$(this).attr("data-value");f.attr("data-value",b).text($(this).text()),j.slideUp(),a._cacheComConfig("system-sort",b),h()})})},j=function(b,g,j,k){var o,p,q,r,s,m=a._getComInfo(),n=b.find('input[type="button"]');for(n.unbind("click").click(function(){l(g,m)}),d=b.find("#com_article_system"),e=b.find("#com_article_systemsort"),o="",p=0;p<c.length;p++)o+='<div data-value="'+c[p]["id"]+'"><span>'+c[p]["name"]+"</span></div>";if(q=d.find(".select-option:first"),q.html(o),r=d.find(".select-dt:first").find(".selected:first"),f=e.find(".select-dt:first").find(".selected:first"),f.html("请选择").attr("data-value",""),0==c.length&&r.html("请选择").attr("data-value",""),k&&k["system-id"])for(p=0;p<c.length;p++)if(k["system-id"]==c[p]["id"]){if(r.html(c[p]["name"]).attr("data-value",c[p]["id"]),k&&k["system-sort"])for(s=0;s<c[p]["articleCategories"].length;s++)if(k["system-sort"]==c[p]["articleCategories"][s]["id"]){f.html(c[p]["articleCategories"][s]["name"]).attr("data-value",c[p]["articleCategories"][s]["id"]);
break}i(c[p]["id"]);break}q.find("div").each(function(){$(this).off("click").on("click",function(){var b=$(this).attr("data-value");r.attr("data-value",b).text($(this).text()),q.slideUp(),a._cacheComConfig("system-id",b),a._cacheComConfig("system-sort",0),f.html("请选择").attr("data-value",""),h(),i(b),g.html('<div class="image-empty"><img src="/images/news-empty.png"/></div>')})})},k=$("<div></div>"),l=function(b,c){var d=a.options.jsurl+"/bar/article_win.html";top.$.Loading(),k.load(d+"?t="+$.getTimeStamp(),null,function(){top.$.UnLoading(),top.$.WinDialog(k,function(d,e){var f=a._getComConfig(c["id"]),g=4,i=k.find(".styleBoxC-in:first"),j=i.find("li"),l=k.find(".btn-green-b:first");f&&f["style-type"]&&(g=f["style-type"]),j.removeClass("selected"),j.each(function(){$(this).attr("data-type")==g&&$(this).addClass("selected"),$(this).click(function(){j.removeClass("selected"),$(this).addClass("selected")})}),l.click(function(){var c=i.find("li.selected:first"),f=$(c).attr("data-type");a._cacheComConfig("style-type",f),b.find(".w-edit-com:first").attr("class","w-edit-com w-adNews w-adNews"+f),h(),e.remove(),d.remove()})})})};b.click(function(){return a.saveComID==$(this).attr("data-id")||a.options.disable?!1:(a._clearFun(),a.$curCom=$(this),a.saveComID=a.$curCom.attr("data-id"),$.WebRequest("/editor/com/article-sort",null,function(b){c=b.systems,g(a.$curCom)}),!1)})},_initFlashBar:function(a,b){var c=!1,d=function(b){a.$comBar.flashBar=a._initBaseWinBar(a,b,a.$comBar.flashBar,COMPONENTTYPE.FLASH,null,function(a,c,d){e(a,b,c,d)},function(){})},e=function(b,c,d,e){var h,i,f=b.find('input[type="button"]');f.off("click").on("click",function(){g(c)}),h=b.find("span.btn-gray-black-b"),h.removeClass("btn-cur"),null!=e&&e["text-align"]?b.find("span.btn-gray-black-b[data-align="+e["text-align"]+"]").addClass("btn-cur"):$(h[0]).addClass("btn-cur"),h.each(function(){$(this).off("click").on("click",function(){h.removeClass("btn-cur"),$(this).addClass("btn-cur"),d.css("text-align",$(this).attr("data-align")),a._cacheComConfig("text-align",$(this).attr("data-align"))})}),i=b.find("input.input-text-b"),null!=e&&(e["width"]&&$(i[0]).val(e["width"]),e["height"]&&$(i[1]).val(e["height"])),$(i[0]).off("keyup").on("keyup",function(){var b=$(this).val(),c="100%";!$.isEmpty(b)&&b>0&&(c=b+"px"),"100%"!=c||$.isEmpty($(i[1]).val())?(d.find("object").attr("width",c),d.find("embed").attr("width",c)):(d.find("object").attr("width",""),d.find("embed").attr("width","")),a._cacheComConfig("width",b>0?b:"")}),$(i[1]).off("keyup").on("keyup",function(){var b=$(this).val(),c="";!$.isEmpty(b)&&b>0&&(c=b+"px"),!$.isEmpty(c)&&$.isEmpty($(i[0]).val())&&(d.find("object").attr("width",""),d.find("embed").attr("width","")),d.find("object").attr("height",c),d.find("embed").attr("height",c),a._cacheComConfig("height",b>0?b:"")})},g=function(b){a._initUpFileWin(b,UPFILETYPE.FLASH,function(b,d,e){var g='<object type="application/x-shockwave-flash" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" align="middle" width="100%">';g+='<param name="movie" value="'+e+'">',g+='<param name="quality" value="high"><param name="play" value="true"> <param name="loop" value="true"><param name="wmode" value="transparent"><param name="allowFullScreen" value="true"><param name="flashvars" value="">',g+='<embed src="'+e+'" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" play="true" loop="true" wmode="transparent" allowfullscreen="true" flashvars="" type="application/x-shockwave-flash" align="middle" width="100%"></object>',g+='<div style="width:100%;left:0;top:0;height:100%;position:absolute;" class="flashtop"></div>',b.html(g),a._cacheComData("resource_id",d),c&&(a.saveComID=0)})};b.on("click",function(){if(a.options.disable)return!1;if(0==$(this).find(".w-edit-com .w-flash-empty:first").length){if(a.saveComID==$(this).attr("data-id"))return!1;a._clearFun(),c=!1,a.$curCom=$(this),d($(this))}else a.$curCom=$(this),c=!0,a.saveComID=a.$curCom.attr("data-id"),g($(this));return!1})},_initFileBar:function(a,b){var c=function(b){a.$comBar.fileBar=a._initBaseWinBar(a,b,a.$comBar.fileBar,COMPONENTTYPE.FILE,null,function(a,c,e){d(a,b,c,e)},function(){})},d=function(b,c,d,e){var i,j,g=a._getComInfo(),h=b.find('input[type="button"]');h.off("click").on("click",function(){f(b,c)}),i=b.find("input.input-text-b"),g&&i.val(g["name"]),i.off("keyup").on("keyup",function(){var b=$(this).val();$.isEmpty(b)?(d.find("span.w-file-name").html(""),d.find("span.w-file-empty").html("文件名称")):(d.find("span.w-file-name").html(b),d.find("span.w-file-empty").html(b)),a._cacheComData("name",b)}),j=b.find("span.btn-gray-black-b"),j.removeClass("btn-cur"),null!=e&&e["text-align"]?b.find("span.btn-gray-black-b[data-align="+e["text-align"]+"]").addClass("btn-cur"):$(j[0]).addClass("btn-cur"),j.each(function(){$(this).off("click").on("click",function(){var b,c,e;j.removeClass("btn-cur"),$(this).addClass("btn-cur"),b=$(this).attr("data-align"),c=d.find("span.w-file-img:first"),e=d.find("span.w-file-info:first"),c.attr("style",""),e.attr("style",""),"left"==b||"right"==b?(d.attr("style",""),"left"==b&&c.css({"float":"left","margin-right":"1em"}),"right"==b&&(c.css({"float":"right","margin-left":"1em"}),e.css({"float":"right"}))):d.css("text-align",$(this).attr("data-align")),a._cacheComConfig("text-align",$(this).attr("data-align"))})})},f=function(b,c){a._initUpFileWin(c,UPFILETYPE.FILE,function(c,d,e,f){b.find("input.input-text-b").val(f),c.find("span.w-file-name").html(f).show(),c.find("span.w-file-down").show(),c.find("span.w-file-empty").hide(),a._cacheComData("name",f),a._cacheComData("resource_id",d)})};b.on("click",function(){return a.saveComID==$(this).attr("data-id")?!1:(a._clearFun(),a.$curCom=$(this),a.saveComID=a.$curCom.attr("data-id"),c($(this)),!1)})},_initVideoLinkBar:function(a,b){var c=function(b){a.$comBar.videoLinkBar=a._initBaseWinBar(a,b,a.$comBar.videoLinkBar,COMPONENTTYPE.VIDEOLINK,null,function(a,c,e){d(a,b,c,e)},function(c,d,f){"size"==c&&(e(b,parseInt(f)),a._cacheComConfig("size",f))})},d=function(b,c,d,e){var h,f=a._getComInfo(),g=b.find("span.btn-gray-black-b");g.removeClass("btn-cur"),null!=e&&e["text-align"]?b.find("span.btn-gray-black-b[data-align="+e["text-align"]+"]").addClass("btn-cur"):$(g[0]).addClass("btn-cur"),g.each(function(){$(this).unbind("click").click(function(){g.removeClass("btn-cur"),$(this).addClass("btn-cur"),d.css("text-align",$(this).attr("data-align")),a._cacheComConfig("text-align",$(this).attr("data-align"))})}),h=b.find("input[data-type=video-link]"),h.val(f["link"]),h.off("keyup").on("keyup",function(){a._cacheComConfig("flash-url",""),$.isEmpty($(this).val())||$.WebRequest("/editor/check/video",{url:$(this).val()},function(b){b.url&&!$.isEmpty(b.url)&&a._cacheComConfig("flash-url",b.url)}),a._cacheComData("link",$(this).val())})},e=function(a,b){var d,c=0;switch(b){case 0:c=a.width();break;case 1:c=300;break;case 2:c=400;break;case 3:c=500;break;case 4:c=650;break;case 5:c=850}c>a.width()&&(c=a.width()),d=9*(c/16),a.find("object").attr("width",0==b?"100%":c).attr("height",d),a.find("object").find("embed").attr("width",0==b?"100%":c).attr("height",d),a.find(".youtubetop").css("height",d+"px")},f=a._getComConfig(b.attr("data-id")),g=0;f&&f["size"]&&(g=parseInt(f["size"])),e(b,g),b.on("click",function(){return a.saveComID==$(this).attr("data-id")||a.options.disable?!1:(a._clearFun(),a.$curCom=$(this),a.saveComID=a.$curCom.attr("data-id"),c($(this)),!1)})},_initSocialIconsBar:function(a,b){var c=function(b){a.$comBar.socialIconsBar=a._initBaseWinBar(a,b,a.$comBar.socialIconsBar,COMPONENTTYPE.SOCIALICONS,null,function(a,c,e){d(a,b,c,e)},function(){})},d=function(b,c,d,f){var h,i;a._getComInfo(),h=b.find("span.btn-gray-black-b"),h.removeClass("btn-cur"),null!=f&&f["text-align"]?b.find("span.btn-gray-black-b[data-align="+f["text-align"]+"]").addClass("btn-cur"):$(h[0]).addClass("btn-cur"),h.each(function(){$(this).off("click").on("click",function(){h.removeClass("btn-cur"),$(this).addClass("btn-cur"),d.css("text-align",$(this).attr("data-align")),a._cacheComConfig("text-align",$(this).attr("data-align"))})}),i=b.find("input[data-type=icon]"),i.off("click").on("click",function(){e(c,null,$(this))})},e=function(b){a.$comBar.socialIconsItemBar=a._initBaseWinBar(a,b,a.$comBar.socialIconsItemBar,COMPONENTTYPE.SOCIALICONS,1,function(c){var l,m,n,o,p,q,r,s,t,i=a._getComInfo(),j=a.$comBar.socialIconsBar.offset(),k=c.find(".btn-blackGray");if(c.css({top:a.$comBar.socialIconsBar.css("top"),left:j.left+a.$comBar.socialIconsBar.width()}).show(),c.find(".social-more-list-b").hide(),c.off("click").on("click",function(a){c.find(".social-more-list-b").slideUp(),k.attr("data-state",0),a.stopPropagation()}),k.off("click").on("click",function(a){0==$(this).attr("data-state")?(c.find(".social-more-list-b").slideDown(),$(this).attr("data-state",1)):(c.find(".social-more-list-b").slideUp(),$(this).attr("data-state",0)),a.stopPropagation()}).attr("data-state",0),l="",m=c.find("ul[data-type=icon-add-list]"),n=c.find("ul[data-type=icon-list]"),m.html(""),i.items&&i.items.length>0){for(o=0;o<i.items.length;o++)l+=g(i.items[o]["id"],parseInt(i.items[o]["item_type"]),i.items[o]["link"]);for(o=1;23>=o;o++){for(p=!1,q=0;q<i.items.length;q++)if(o==parseInt(i.items[q]["item_type"])){p=!0;break}p||f(m,o)}0==m.find("li").length&&k.hide()}else for(l+=g(0,1),l+=g(0,2),l+=g(0,3),l+=g(0,4),l+=g(0,5),o=6;23>=o;o++)f(m,o);r=function(){m.find("li").off("click").on("click",function(){n.append(g(0,parseInt($(this).attr("data-value")))),h(b,parseInt($(this).attr("data-value"))),$(this).remove(),s(),0==m.find("li").length&&k.hide(),t(),c.find(".social-more-list-b").slideUp()})},s=function(){n.find("li").each(function(){$(this).find("span.social-delete").off("click").on("click",function(){c.find("ul[data-type=icon-list]").find("li").length>1&&($(this).parents("li:first").remove(),f(m,parseInt($(this).attr("data-value"))),b.find("a[data-value="+$(this).attr("data-value")+"]").remove(),r(),t()),m.find("li").length>0&&k.show()}),$(this).find("input.input-social").off("keyup").on("keyup",function(){t()})})},r(),n.html(l),s(),t=function(){var b=[];n.find("li").each(function(){var a=$(this).find("input.input-social:first");b[b.length]={item_type:a.attr("data-value"),link:a.val()}}),a._cacheComData("items",b)}},function(){})},f=function(a,b){var c="",d="";switch(b){case 1:c="icon-social-facebook",d="Facebook";break;case 2:c="icon-social-twitter",d="Twitter.com";break;case 3:c="icon-social-instagram",d="Instagram";break;case 4:c="icon-social-linkedin",d="Linkedin";break;case 5:c="icon-social-mail",d="Mail";break;case 6:c="icon-social-flickr",d="Flickr";break;case 7:c="icon-social-pinterest",d="Pinterest";break;case 8:c="icon-social-google",d="Google+";break;case 9:c="icon-social-rss",d="RSS";break;case 10:c="icon-social-vimeo",d="Vimeo";break;case 11:c="icon-social-yahho",d="Yahoo!";break;case 12:c="icon-social-youtube",d="YouTube";break;case 13:c="icon-social-dribbble",d="Dribbble";break;case 14:c="icon-social-douban",d="豆瓣";break;case 15:c="icon-social-zhihu",d="知乎";break;case 16:c="icon-social-renren",d="人人网";break;case 17:c="icon-social-tenxun",d="腾讯微博";break;case 18:c="icon-social-xinlang",d="新浪微博";break;case 19:c="icon-social-QQkongjian",d="QQ空间";break;case 20:c="icon-social-dazong",d="大众点评";break;case 21:c="icon-social-tianya",d="天涯论坛";break;case 22:c="icon-social-kaixin",d="开心网";break;case 23:c="icon-social-pengyouweb",d="朋友网"}a.append('<li data-value="'+b+'"><span>'+d+'</span><i class="icon-social '+c+'"></i></li>')},g=function(a,b,c){var d="",e="",f="";switch(b){case 1:d="social-facebook",e="icon-social-facebook",f="http://facebook.com/example";break;case 2:d="social-twitter",e="icon-social-twitter",f="http://twitter.com/example";break;case 3:d="social-instagram",e="icon-social-instagram",f="http://instagram.com/example";break;case 4:d="social-linkedin",e="icon-social-linkedin",f="http://linkedin.com/in/example";break;case 5:d="social-mail",e="icon-social-mail",f="http://example@example.com";break;case 6:d="social-flickr",e="icon-social-flickr",f="http://flickr.com/photos/example";break;case 7:d="social-pinterest",e="icon-social-pinterest",f="http://pinterest.com/example";break;case 8:d="social-google",e="icon-social-google",f="http://plus.google.com/example";break;case 9:d="social-rss",e="icon-social-rss",f="http://example.com/feed.rss";break;case 10:d="social-vimeo",e="icon-social-vimeo",f="http://vimeo.com/example";break;case 11:d="social-yahho",e="icon-social-yahho",f="http://yahoo.com/example";break;case 12:d="social-youtube",e="icon-social-youtube",f="http://youtube.com/user/example";break;case 13:d="social-dribbble",e="icon-social-dribbble",f="http://dribbble.com/example";break;case 14:d="social-douban",e="icon-social-douban",f="http://douban.com/example";break;case 15:d="social-zhihu",e="icon-social-zhihu",f="http://zhihu.com/example";break;case 16:d="social-renren",e="icon-social-renren",f="http://renren.com/example";break;case 17:d="social-tenxun",e="icon-social-tenxun",f="http://t.qq.com/example";break;case 18:d="social-xinlang",e="icon-social-xinlang",f="http://weibo.com/example";break;case 19:d="social-QQkongjian",e="icon-social-QQkongjian",f="http://user.qzone.qq.com/example";break;case 20:d="social-dazong",e="icon-social-dazong",f="http://dianping.com/example";break;case 21:d="social-tianya",e="icon-social-tianya",f="http://bbs.tianya.cn/example";break;case 22:d="social-kaixin",e="icon-social-kaixin",f="http://kaixin001.com/example";break;case 23:d="social-pengyouweb",e="icon-social-pengyouweb",f="http://pengyou.com/example"}return'<li><div class="social-li-in clearfix"><div class="social-pop-item '+d+'"><span class="social-icon"><i class="icon-social '+e+'"></i></span><span class="social-input"><input placeholder="'+f+'" class="input-social" type="text" data-value="'+b+'" data-id="'+a+'" value="'+(c?c:"")+'"></span>'+'<span class="social-delete" data-value="'+b+'"><i class="icon-other icon-social-delete"></i></span></div></div></li>'},h=function(a,b){var c="",d="";switch(b){case 1:c="social-facebook",d="icon-social-facebook";break;case 2:c="social-twitter",d="icon-social-twitter";break;case 3:c="social-instagram",d="icon-social-instagram";break;case 4:c="social-linkedin",d="icon-social-linkedin";break;case 5:c="social-mail",d="icon-social-mail";break;case 6:c="social-flickr",d="icon-social-flickr";break;case 7:c="social-pinterest",d="icon-social-pinterest";break;case 8:c="social-google",d="icon-social-google";break;case 9:c="social-rss",d="icon-social-rss";break;case 10:c="social-vimeo",d="icon-social-vimeo";break;case 11:c="social-yahoo",d="icon-social-yahoo";break;case 12:c="social-youtube",d="icon-social-youtube";break;case 13:c="social-dribbble",d="icon-social-dribbble";break;case 14:c="social-douban",d="icon-social-douban";break;case 15:c="social-zhihu",d="icon-social-zhihu";break;case 16:c="social-renren",d="icon-social-renren";break;case 17:c="social-tenxun",d="icon-social-tenxun";break;case 18:c="social-xinlang",d="icon-social-xinlang";break;case 19:c="social-QQkongjian",d="icon-social-QQkongjian";break;case 20:c="social-dazong",d="icon-social-dazong";break;case 21:c="social-tianya",d="icon-social-tianya";break;case 22:c="social-kaixin",d="icon-social-kaixin";break;case 23:c="social-pengyouweb",d="icon-social-pengyouweb"}a.find(".w-social-in").append('<a data-social="mail" data-value="'+b+'" class="social-item '+c+'" href="javascript:void(0);"><i class="icon-social '+d+'"></i></a>')};a._clearFun(),b.on("click",function(){return a.saveComID==$(this).attr("data-id")||a.options.disable?!1:(a._clearFun(),a.$curCom=$(this),a.saveComID=a.$curCom.attr("data-id"),c($(this)),!1)})},_countPosFun:function(a,b){var c,d;return b.length>0&&(c=b.offset(),this.boxParm.left=c.left,this.boxParm.top=c.top,this.boxParm.width=b.outerWidth(),this.boxParm.height=b.outerHeight(),d=this.boxParm.top,0==this.moveType&&(d-=this._getScrollTop()),a.pageX>=this.boxParm.left+this.iframeLeft&&a.pageX<=this.boxParm.left+this.iframeLeft+this.boxParm.width&&a.pageY>=d+this.iframeTop&&a.pageY<=d+this.iframeTop+this.boxParm.height)?!0:!1},_getBarHtml:function(a,b,c,d){var e=this.options.jsurl+"/bar/",f="";switch(b){case COMPONENTTYPE.TITLE:f="title.html";break;case COMPONENTTYPE.BUTTON:f="button.html";break;case COMPONENTTYPE.DIVIDER:f="divider.html";break;case COMPONENTTYPE.SEARCH:f="search.html";break;case COMPONENTTYPE.IMAGE:f="image.html";break;case COMPONENTTYPE.GALLERY:if(null==c)f="gallery.html";else switch(c){case 1:f="gallery_link.html";break;case 2:f="gallery_caption.html"}break;case COMPONENTTYPE.SLIDESHOW:if(null==c)f="slide.html";else switch(c){case 1:f="slide_link.html";break;case 2:f="slide_caption.html"}break;case COMPONENTTYPE.CODE:f="code.html";break;case COMPONENTTYPE.MAP:f="map.html";break;case COMPONENTTYPE.PRODUCT:f="product.html";break;case COMPONENTTYPE.ARTICLE:f="article.html";break;case COMPONENTTYPE.FLASH:f="flash.html";break;case COMPONENTTYPE.FILE:f="file.html";break;case COMPONENTTYPE.VIDEOLINK:f="videolink.html";break;case COMPONENTTYPE.SOCIALICONS:if(null==c)f="social_icons.html";else switch(c){case 1:f="social_icons_item.html"}}""!=f?(top.$.Loading(),a.load(e+f+"?t="+$.getTimeStamp(),null,function(b,c){top.$.UnLoading(),"success"==c&&"function"==typeof d&&d(a)})):top.$.ShowResultMag("页面不存在。",!1)},CloseAll:function(){this.CloseBar(),this.CloseLogo(),this.CloseBanner(),$("div.li-div[data-type=3]").each(function(){var a=$(this).find(".w-edit-com");a.noteTxt("clear")})},CloseBar:function(){if($.each(this.$comBar,function(){null!=this&&$(this).hide()}),this.options.editing=!1,null!=this.$deleteAlert&&this.$deleteAlert.hide(),null!=this.$copyWindow&&this.$copyWindow.hide(),null!=this.$comBox&&this.$comBox.find("div.li-div[data-id]").removeClass("li-div-moveto-hover").removeClass("li-div-delete-hover"),null!=this.$contentBox){this.$contentBox.find("div.gallery-tool-b").hide();var a=this.$contentBox.find("div.w-code");a.find("textarea").hide(),a.find("div.code-info").show()}null!=this.$footerBox&&this.$footerBox.find("div.gallery-tool-b").hide(),this.saveComID=0},CloseLogo:function(){null!=this.$logoBox&&(this.$logoBox.find("h1").blur(),this.$logoWindow.hide())},CloseBanner:function(){},_autoCountWidth:function(){var a=this;window.setInterval(function(){a.$body.width()<=768?(a.options.disable=!0,a._clearFun(),a.$eidtLeftMask.show(),a.$bannerWindow.hide()):(a.options.disable=!1,a.$bannerWindow.show())},200)},SetDisable:function(a){this._clearFun(),this.options.disable=a},_clearFun:function(){this.iframeLeft=357,this.iframeTop=40,this.$body.removeClass("noChoose"),1==this.moveBoxType&&this.$baffle&&this.$baffle.hide(),this.$dropCom=null,this.options.moving=!1,null!=this.docTime&&clearInterval(this.docTime),this.$topBody.off("mouseup mousedown mousemove"),this.$body.off("mouseup mousedown mousemove"),this.$innerMoveMask.css({left:-500,top:-500}).hide(),this.$moveMask.css({left:-500,top:-500}).hide(),this.$posMask.css({left:-500,top:-500}).hide(),this.options.status=0,this.isNewBox=!1,this.dropPos="",this.options.moving=!1,this.options.deleting=!1,this.options.copying=!1,this.options.editing=!1,this.$deleteAlert.hide(),this.$copyWindow.hide(),this.$curCom=null,this.CloseAll(),this.comInfo={},this.$curCom=null,this.saveComID=0},_getComInfo:function(a){var c,d,b=this.saveComID;for(a&&(b=a),c=null,1==this.moveBoxType?c=PAGEALLCOM:2==this.moveBoxType&&(c=FOOTERALLCOM),d=0;d<c.length;d++)if(c[d]["id"]==b)return c[d];return null},_getComConfig:function(id){var allCom,i,temConfig,temID=this.saveComID;for(id&&(temID=id),allCom=null,1==this.moveBoxType?allCom=PAGEALLCOM:2==this.moveBoxType&&(allCom=FOOTERALLCOM),i=0;i<allCom.length;i++)if(allCom[i]["id"]==temID&&(temConfig=allCom[i]["config"],null!=temConfig&&!$.isEmpty(temConfig)))return eval("("+temConfig+")");return null},_cacheDataJson:function(a,b,c){var d=this.pageData[a];null==d&&(d={}),d[b]=c,this.pageData[a]=d},_checkComInfo:function(){var b,a=this;return null!=this.pageData.com?(b=[],$.each(this.pageData.com,function(c,d){var e=!0;$.each(1==a.moveBoxType?PAGEALLCOM:FOOTERALLCOM,function(){if(this["id"]==d["id"]){for(var a in d){if("undefined"==typeof this[a]){e=!1;break}if(d[a]!=this[a]){e=!1;break}}return!1}}),e||(b[b.length]=d)}),this.pageData.com=b,this.pageData.com.length>0?!1:!0):!0},_editComInfo:function(){var a=this;null!=this.pageData.com&&$.each(this.pageData.com,function(b,c){$.each(1==a.moveBoxType?PAGEALLCOM:FOOTERALLCOM,function(){if(this["id"]==c["id"]){for(var a in c)"undefined"!=typeof this[a]?this[a]!=c[a]&&(this[a]=c[a]):this[a]=c[a];return!1}})})},_autoImage:function(){$("img[autoimage=1]").each(function(){$.AutoImageSize(this)})},_checkOneInfo:function(a,b){var c,d;if(null==b)return!1;c=!0;for(d in a){if("undefined"==typeof b[d]){c=!1;break}if(a[d]!=b[d]){c=!1;break}}return c},_editOneInfo:function(a,b){for(var c in a)"undefined"!=typeof b[c]&&a[c]!=b[c]&&(b[c]=a[c]);return b},ResetPage:function(){var a=this;$.each(SITEMENUS,function(){return HOSTCONFIG.PAGE_ID==this.page_id?(a.GetPage(this.id),!1):void 0})},GetPage:function(a,b){var c=this;this.clearMain(),this.$eidtLeftMask.show(),$.WebRequest("/editor/page",{id:a},function(a){c.options.disable||c.$eidtLeftMask.hide(),PAGEJSON=a.page_json,HOSTCONFIG.PAGE_ID=a.page_json.curmenu["id"],SITEMENUS=a.page_json.menus,PAGEALLCOM=a.page_json.maincoms,FOOTERALLCOM=a.page_json.footercoms,SITECONFIG=a.page_json.siteconfig,SITEBANNER=a.page_json.banner,SITECURMENU=a.page_json.curmenu,$("#themecss").attr("href","/template/"+a.page_json.theme+"/css/theme.css"),$("#colorcss").attr("href","/template/"+a.page_json.theme+"/css/color_"+a.page_json.color+".css"),c.menuType=parseInt(a.page_json.pagetype),c.$mainBox.html(a.res),c.initMain(),c.CloseBar(),$("div.text-menubox-b").remove(),"function"==typeof b&&b()},null)},SaveAll:function(){},SavePage:function(a,b){var c=this;this.clearMain(),this.$eidtLeftMask.show(),this._countPageAllComPos(),$.WebRequest("/editor/page/save",{pageid:HOSTCONFIG.PAGE_ID,pagejson:JSON.stringify(PAGEJSON)},function(d){c.update=!1,c.$eidtLeftMask.hide(),1==d.code&&(a?c.GetPage(HOSTCONFIG.PAGE_ID,b):"function"==typeof b&&b())})},_cacheLogoData:function(a,b){PAGEJSON.siteconfig[a]=b,PAGEJSON.siteconfig["update"]=1,this.update=!0},_cacheBannerData:function(a,b){PAGEJSON.banner[a]=b,PAGEJSON.banner["update"]=1,this.update=!0},_getCacheComData:function(a){var c,b=1==this.moveBoxType?PAGEJSON.maincoms:PAGEJSON.footercoms;for(c=0;c<b.length;c++)if(b[c]["id"]==a)return b[c];return null},_cacheComData:function(a,b){var c,d;if(0==this.saveComID)return!1;for(c=1==this.moveBoxType?PAGEJSON.maincoms:PAGEJSON.footercoms,d=0;d<c.length;d++)if(c[d]["id"]==this.saveComID){c[d][a]="items"==a&&0==b.length?null:b,c[d]["add"]||(c[d]["update"]=1);break}this.update=!0},_cacheComConfig:function(key,val){var comList,i,temConfig;if(0==this.saveComID)return!1;for(comList=1==this.moveBoxType?PAGEJSON.maincoms:PAGEJSON.footercoms,i=0;i<comList.length;i++)if(comList[i]["id"]==this.saveComID){temConfig=$.isEmpty(comList[i]["config"])?{}:eval("("+comList[i]["config"]+")"),temConfig[key]=val,comList[i]["config"]=JSON.stringify(temConfig),comList[i]["add"]||(comList[i]["update"]=1);break}this.update=!0},_delCacheComData:function(a){var c,b=1==this.moveBoxType?PAGEJSON.maincoms:PAGEJSON.footercoms;for(c=0;c<b.length;c++)if(b[c]["id"]==a){b[c]["delete"]=1;break}this.update=!0},_countPageAllComPos:function(){this._countAllComPos(0,1,$(this.$element.find("div.wrap-content-in:first")),PAGEJSON.maincoms),this._countAllComPos(0,1,$("#comFootMainInner"),PAGEJSON.footercoms)},_countAllComPos:function(a,b,c,d){var g,h,i,j,k,l,m,n,e=c.children("div.li-div[data-id]"),f=0;for(g=0;g<e.length;g++){if(h=$(e[g]),i="",j=null,k=parseInt(h.attr("data-type")),l=parseInt(h.attr("data-id")),1==k){for(j=h.find("td.td-w[data-id="+l+"]"),m=0;m<j.length;m++)""!=i&&(i+=","),i+='{"column":"'+(m+1)+'","width":"'+$(j[m]).attr("width").replace("%","")+'"}';i="["+i+"]"}else f++;for(n=0;n<d.length;n++)if(parseInt(d[n]["id"])==l){(d[n]["parent_id"]!=a||d[n]["pos_column"]!=b||d[n]["pos_row"]!=g+1)&&(d[n]["parent_id"]=a,d[n]["pos_column"]=b,d[n]["pos_row"]=g+1,d[n]["update"]=1,this.update=!0),1==k&&i!=d[n]["config"]&&(d[n]["config"]=i,d[n]["update"]=1,this.update=!0);break}if(1==k)for(m=0;m<j.length;m++)this._countAllComPos(l,m+1,$($(j[m]).find("div:first")),d)}return f==e.length?!0:!1},_cacheNewComData:function(a,b,c,d){var i,j,k,l,e=1==this.moveBoxType?PAGEJSON.maincoms:PAGEJSON.footercoms,f=a["curboxid"],g=null,h=null;if(null!=b&&!$.isNllEmpty(b["id"]))if(i=b["id"],0==i)for(j={},k=this.uuid++,j["id"]=k,j["host_id"]=HOSTCONFIG.HOST_ID,j["site_id"]=HOSTCONFIG.SITE_ID,j["page_id"]=1==this.moveBoxType?HOSTCONFIG.PAGE_ID:0,j["type_id"]=1,j["parent_id"]=f,b["pos_row"]&&(j["pos_row"]=b["pos_row"]),b["pos_column"]&&(j["pos_column"]=b["pos_column"]),j["config"]=b["config"],j["add"]=1,e[e.length]=j,f=k,l=0;l<e.length;l++)e[l]["id"]==a["dropcomid"]&&(e[l]["parent_id"]=k,e[l]["pos_row"]=1,e[l]["pos_column"]=2,"right"==a["droppos"]&&(e[l]["pos_column"]=1),e[l]["update"]=1);else i>0&&(f=i,j=this._getCacheComData(i),j["config"]=b["config"],j["update"]=1);if(0==this.moveType)c["id"]=this.uuid++,c["parent_id"]=f,c["add"]=1,c["host_id"]=HOSTCONFIG.HOST_ID,c["site_id"]=HOSTCONFIG.SITE_ID,c["page_id"]=1==this.moveBoxType?HOSTCONFIG.PAGE_ID:0,c["type_id"]==COMPONENTTYPE.TITLE&&(c["info"]="TITLE",c["config"]='{"title-type":"'+HOSTCONFIG.THEME_TITLE+'"}'),e[e.length]=c,h=c;else if(1==this.moveType&&c.id>0)for(l=0;l<e.length;l++)if(e[l]["id"]==c.id){e[l]["parent_id"]=f,e[l]["pos_row"]=c["pos_row"],e[l]["pos_column"]=c["pos_column"],e[l]["update"]=1,h=e[l];break}"function"==typeof d&&d(h,g),this.update=!0},DeleteCom:function(a,b,c,d,e){this._delCacheComData(a),this.options.disable||this.$eidtLeftMask.hide();var g=this._getCacheComData(b);"function"==typeof e&&e(g),this.options.deleting=!1},CopyCom:function(a,b){var d,e,f,g,h,c=this;this.$eidtLeftMask.show(),d=this._getComInfo(a),1==this.copyType&&b==HOSTCONFIG.PAGE_ID?(this.CloseBar(),e=PAGEJSON.maincoms,f=jQuery.extend(!0,{},d),f["id"]=this.uuid++,f["add"]=1,e[e.length]=f,g=$("#com_"+a),h=$("<div></div>"),h.attr({id:"com_"+f["id"],"class":"li-div","data-id":f["id"],"data-column":f["pos_column"],"data-row":f["pos_row"],"data-type":g.attr("data-type")}),h.html(g.find(".w-edit-com:first").prop("outerHTML")),h.insertBefore(g),this._initBindComEvent(this,h)):$.WebRequest("/editor/page/copy-com",{com:JSON.stringify(d),curpageid:HOSTCONFIG.PAGE_ID,pageid:b,copytype:this.copyType},function(b){c.options.disable||c.$eidtLeftMask.hide(),c.options.copying=!1,1==b.code?(0==c.copyType&&c._deleteCurCom($("#com_"+a)),c.CloseBar()):top.$.ShowResultMag("操作失败。",!1)}),this.update=!0},GotoMainPage:function(){this.GetPage(0)},SavaCurPage:function(){1==this.update&&this.SavePage(!0)},ReleasePage:function(a){1==this.update?this.SavePage(!0,a):"function"==typeof a&&a()},GetMenu:function(a){if(1==this.update){var b=this;this.SavePage(!1,function(){b.GetPage(a)})}else this.GetPage(a)},RefreshPage:function(){1==this.update?this.SavePage(!0):this.GetPage(HOSTCONFIG.PAGE_ID)},SetPageTemplate:function(a,b){$("#themecss").attr("href","/template/"+a+"/css/theme.css"),$("#colorcss").attr("href","/template/"+a+"/css/color_"+b+".css"),PAGEJSON["theme"]=a,PAGEJSON["color"]=b,PAGEJSON["themeupdate"]=1},option:function(a,b){return b&&(this.options[a]=b),this.options[a]}},$.fn.webEditor=function(a){var b=arguments;return void 0===a||"object"==typeof a?this.each(function(){$.data(this,"webEditor")||$.data(this,"webEditor",new webEditor(this,a))}):"string"==typeof a&&"_"!==a[0]?this.each(function(){var c=$.data(this,"webEditor");c instanceof webEditor&&"function"==typeof c[a]&&c[a].apply(c,Array.prototype.slice.call(b,1)),"destroy"===a&&$.data(this,"webEditor",null)}):void 0}}(jQuery,window);